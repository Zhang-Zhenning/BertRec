
Markov Chains

These notes contain material prepared by colleagues who have also presented this course

at Cambridge, especially James Norris.

The material mainly comes from books of

Norris, Grimmett &amp; Stirzaker, Ross, Aldous &amp; Fill, and Grinstead &amp; Snell. Many of

the examples are classic and ought to occur in any sensible course on Markov chains.

Contents

Table of Contents

i

Schedules

iv

1

Deﬁnitions, basic properties, the transition matrix

1

1.1

An example and some interesting questions

. . . . . . . . . . . . . . . .

1

1.2

Deﬁnitions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

2

1.3

Where do Markov chains come from? . . . . . . . . . . . . . . . . . . . .

3

1.4

How can we simulate them? . . . . . . . . . . . . . . . . . . . . . . . . .

3

1.5

The n-step transition matrix

. . . . . . . . . . . . . . . . . . . . . . . .

3

1.6

P (n) for a two-state Markov chain

. . . . . . . . . . . . . . . . . . . . .

4

2

Calculation of n-step transition probabilities, class structure, absorp-

tion, and irreducibility

5

2.1

Example: a three-state Markov chain . . . . . . . . . . . . . . . . . . . .

5

2.2

Example: use of symmetry . . . . . . . . . . . . . . . . . . . . . . . . . .

6

2.3

Markov property . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

6

2.4

Class structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

7

2.5

Closed classes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

8

2.6

Irreducibility

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

8

3

Hitting probabilities and mean hitting times

9

3.1

Absorption probabilities and mean hitting times

. . . . . . . . . . . . .

9

3.2

Calculation of hitting probabilities and mean hitting times . . . . . . . .

9

3.3

Absorption probabilities are minimal solutions to RHEs . . . . . . . . .

11

3.4

Gambler’s ruin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

12

4

Survival probability for birth and death chains, stopping times

and strong Markov property

13

4.1

Survival probability for birth death chains . . . . . . . . . . . . . . . . .

13

4.2

Mean hitting times are minimal solutions to RHEs . . . . . . . . . . . .

14

4.3

Stopping times . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

15

4.4

Strong Markov property . . . . . . . . . . . . . . . . . . . . . . . . . . .

15

i


5

Recurrence and transience

17

5.1

Recurrence and transience . . . . . . . . . . . . . . . . . . . . . . . . . .

17

5.2

Equivalence of recurrence and certainty of return . . . . . . . . . . . . .

17

5.3

Equivalence of transience and summability of n-step transition probabilities 18

5.4

Recurrence as a class property

. . . . . . . . . . . . . . . . . . . . . . .

18

5.5

Relation with closed classes . . . . . . . . . . . . . . . . . . . . . . . . .

19

6

Random walks in dimensions one, two and three

21

6.1

Simple random walk on Z . . . . . . . . . . . . . . . . . . . . . . . . . .

21

6.2

Simple symmetric random walk on Z2

. . . . . . . . . . . . . . . . . . .

22

6.3

Simple symmetric random walk on Z3

. . . . . . . . . . . . . . . . . . .

23

6.4

*A continuized analysis of random walk on Z3* . . . . . . . . . . . . . .

24

6.5

*Feasibility of wind instruments* . . . . . . . . . . . . . . . . . . . . . .

24

7

Invariant distributions

25

7.1

Examples of invariant distributions . . . . . . . . . . . . . . . . . . . . .

25

7.2

Notation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

25

7.3

What does an invariant measure or distribution tell us?

. . . . . . . . .

26

7.4

Invariant distribution is the solution to LHEs . . . . . . . . . . . . . . .

26

7.5

Stationary distributions . . . . . . . . . . . . . . . . . . . . . . . . . . .

28

7.6

Equilibrium distributions

. . . . . . . . . . . . . . . . . . . . . . . . . .

28

8

Existence and uniqueness of invariant distribution, mean return time,

positive and null recurrence

29

8.1

Existence and uniqueness up to constant multiples . . . . . . . . . . . .

29

8.2

Mean return time, positive and null recurrence

. . . . . . . . . . . . . .

31

8.3

Random surfer

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

32

9

Convergence to equilibrium for ergodic chains

33

9.1

Equivalence of positive recurrence and the existence of an invariant dis-

tribution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

33

9.2

Aperiodic chains

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

34

9.3

Convergence to equilibrium *and proof by coupling* . . . . . . . . . . .

35

10 Long-run proportion of time spent in given state

37

10.1 Ergodic theorem

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

37

10.2 *Kemeny’s constant and the random target lemma*

. . . . . . . . . . .

39

11 Time reversal, detailed balance, reversibility, random walk on a graph 41

11.1 Time reversal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

41

11.2 Detailed balance

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

42

11.3 Reversibility . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

43

11.4 Random walk on a graph

. . . . . . . . . . . . . . . . . . . . . . . . . .

43

ii


12 Concluding problems and recommendations for further study

45

12.1 Reversibility and Ehrenfest’s urn model

. . . . . . . . . . . . . . . . . .

45

12.2 Reversibility and the M/M/1 queue

. . . . . . . . . . . . . . . . . . . .

46

12.3 *The probabilistic abacus* . . . . . . . . . . . . . . . . . . . . . . . . . .

47

12.4 *Random walks and electrical networks* . . . . . . . . . . . . . . . . . .

47

12.5 Probability courses in Part II . . . . . . . . . . . . . . . . . . . . . . . .

50

Appendix

51

A Probability spaces

51

B Historical notes

52

C The probabilistic abacus for absorbing chains

53

Index

56

Topics marked * * are non-examinable. Furthermore, only Appendix A is examinable.

Richard Weber, October 2011

iii


Schedules

Deﬁnition and basic properties, the transition matrix. Calculation of n-step transition

probabilities. Communicating classes, closed classes, absorption, irreducibility. Calcu-

lation of hitting probabilities and mean hitting times; survival probability for birth and

death chains. Stopping times and statement of the strong Markov property. [5]

Recurrence and transience; equivalence of transience and summability of n-step

transition probabilities; equivalence of recurrence and certainty of return. Recurrence

as a class property, relation with closed classes. Simple random walks in dimensions

one, two and three. [3]

Invariant distributions, statement of existence and uniqueness up to constant mul-

tiples. Mean return time, positive recurrence; equivalence of positive recurrence and

the existence of an invariant distribution. Convergence to equilibrium for irreducible,

positive recurrent, aperiodic chains *and proof by coupling*. Long-run proportion of

time spent in given state. [3]

Time reversal, detailed balance, reversibility; random walk on a graph. [1]

Learning outcomes

A Markov process is a random process for which the future (the next step) depends

only on the present state; it has no memory of how the present state was reached. A

typical example is a random walk (in two dimensions, the drunkards walk). The course

is concerned with Markov chains in discrete time, including periodicity and recurrence.

For example, a random walk on a lattice of integers returns to the initial position

with probability one in one or two dimensions, but in three or more dimensions the

probability of recurrence in zero. Some Markov chains settle down to an equilibrium

state and these are the next topic in the course. The material in this course will be

essential if you plan to take any of the applicable courses in Part II. Learning outcomes

By the end of this course, you should:

• understand the notion of a discrete-time Markov chain and be familiar with both

the ﬁnite state-space case and some simple inﬁnite state-space cases, such as

random walks and birth-and-death chains;

• know how to compute for simple examples the n-step transition probabilities,

hitting probabilities, expected hitting times and invariant distribution;

• understand the notions of recurrence and transience, and the stronger notion of

positive recurrence;

• understand the notion of time-reversibility and the role of the detailed balance

equations;

• know under what conditions a Markov chain will converge to equilibrium in long

time;

• be able to calculate the long-run proportion of time spent in a given state.

iv


1

Deﬁnitions, basic properties, the transition matrix

Markov chains were introduced in 1906 by Andrei Andreyevich Markov (1856–1922)

and were named in his honor.

1.1

An example and some interesting questions

Example 1.1. A frog hops about on 7 lily pads. The numbers next to arrows show the

probabilities with which, at the next jump, he jumps to a neighbouring lily pad (and

when out-going probabilities sum to less than 1 he stays where he is with the remaining

probability).



1

4

3

7

6

1

2

5



1

1

1



2

1



2

1



2

1



2

1



2

1



2

1



2

1



4

1



4

P =





























0

1

0

0

0

0

0

0

1



2

1



2

0

0

0

0

1



2

0

1



2

0

0

0

0

0

0

1



4

1



2

1



4

0

0

0

0

0

0

0

1



2

1



2

0

0

0

1

0

0

0

0

0

0

0

0

0

1





























There are 7 ‘states’ (lily pads). In matrix P the element p57 (= 1/2) is the probability

that, when starting in state 5, the next jump takes the frog to state 7. We would like

to know where do we go, how long does it take to get there, and what happens in the

long run? Speciﬁcally:

(a) Starting in state 1, what is the probability that we are still in state 1 after 3

steps? (p(3)

11 = 1/4) after 5 steps? (p(5)

11 = 3/16) or after 1000 steps? (≈ 1/5 as

limn→∞ p(n)

11 = 1/5)

(b) Starting in state 4, what is the probability that we ever reach state 7? (1/3)

(c) Starting in state 4, how long on average does it take to reach either 3 or 7? (11/3)

(d) Starting in state 2, what is the long-run proportion of time spent in state 3? (2/5)

Markov chains models/methods are useful in answering questions such as: How long

does it take to shuﬄe deck of cards? How likely is a queue to overﬂow its buﬀer? How

long does it take for a knight making random moves on a chessboard to return to his

initial square (answer 168, if starting in a corner, 42 if starting near the centre). What

do the hyperlinks between web pages say about their relative popularities?

1


1.2

Deﬁnitions

Let I be a countable set, {i, j, k, . . . }. Each i ∈ I is called a state and I is called the

state-space.

We work in a probability space (Ω, F, P). Here Ω is a set of outcomes, F is a

set of subsets of Ω, and for A ∈ F, P(A) is the probability of A (see Appendix A).

The object of our study is a sequence of random variables X0, X1, . . . (taking values

in I) whose joint distribution is determined by simple rules. Recall that a random

variable X with values in I is a function X : Ω → I.

A row vector λ = (λi : i ∈ I) is called a measure if λi ≥ 0 for all i.

If �

i λi = 1 then it is a distribution (or probability measure). We start with an

initial distribution over I, speciﬁed by {λi : i ∈ I} such that 0 ≤ λi ≤ 1 for all i and

�

i∈I λi = 1.

The special case that with probability 1 we start in state i is denoted λ = δi =

(0, . . . , 1, . . . , 0).

We also have a transition matrix P = (pij : i, j ∈ I) with pij ≥ 0 for all i, j.

It is a stochastic matrix, meaning that pij ≥ 0 for all i, j ∈ I and �

j∈I pij = 1

(i.e. each row of P is a distribution over I).

Deﬁnition 1.2. We say that (Xn)n≥0 is a Markov chain with initial distribution λ

and transition matrix P if for all n ≥ 0 and i0, . . . , in+1 ∈ I,

(i) P(X0 = i0) = λi0;

(ii) P(Xn+1 = in+1 | X0 = i0, . . . , Xn = in) = P(Xn+1 = in+1 | Xn = in) = pinin+1.

For short, we say (Xn)n≥0 is Markov(λ, P ). Checking conditions (i) and (ii) is

usually the most helpful way to determine whether or not a given random process

(Xn)n≥0 is a Markov chain. However, it can also be helpful to have the alternative

description which is provided by the following theorem.

Theorem 1.3. (Xn)n≥0 is Markov(λ, P) if and only if for all n ≥ 0 and i0, . . . , in ∈ I,

P(X0 = i0, . . . , Xn = in) = λi0pi0i1 · · · pin−1in.

(1.1)

Proof. Suppose (Xn)n≥0 is Markov(λ, P). Then

P(X0 = i0, . . . , Xn = in)

= P(Xn = in | X0 = i0, . . . , Xn−1 = in−1)P(X0 = i0, . . . , Xn−1 = in−1)

= P(X0 = i0)P(X1 = i1 | X0 = i0) · · · P(Xn = in | X0 = i1, . . . , Xn−1 = in−1)

= λi0pi0i1 · · · pin−1in.

On the other hand if (1.1) holds we can sum it over all i1, . . . , in, to give P(X0 =

i0) = λ0, i.e (i). Then summing (1.1) on in we get P(X0 = i0, . . . , Xn−1 = in−1) =

λi0pi0i1 · · · pin−2in−1. Hence

P(Xn = in | X0 = i0, . . . , Xn−1 = in−1) =

P(X0 = i0, . . . , Xn = in)



P(X0 = i0, . . . , Xn−1 = in−1) = pin−1in,

2


which establishes (ii).









1.3

Where do Markov chains come from?

At each time we apply some new ‘randomness’ to determine the next step, in a way

that is a function only of the current state. We might take U1, U2, . . . as some i.i.d.

random variables taking values in a set E and a function F : I × E → I.

Take i ∈ I. Set X0 = i and deﬁne recursively Xn+1 = F(Xn, Un+1), n ≥ 0. Then

(Xn)n≥0 is Markov(δi, P) where pij = P(F(i, U) = j).

1.4

How can we simulate them?

Use a computer to simulate U1, U2, . . . as i.i.d. U[0, 1]. Deﬁne F(U, i) = J by the rules

U ∈ [0, pi1)

=⇒ J = 1

U ∈

��j−1

k=1 pik, �j

k=1 pik

�

,

j ≥ 2

=⇒ J = j.

1.5

The n-step transition matrix

Let A be an event. A convenient notation is Pi(A) = P(A | X0 = i). For example

Pi(X1 = j) = pij.

Given the initial distribution λ, let us treat it as a row vector. Then

P(X1 = j) =

�

i∈I

λiPi(X1 = j) =

�

i∈I

λipij.

Similarly,

Pi(X2 = j) =

�

k

Pi(X1 = k, X2 = j) =

�

k

pikpkj = (P 2)ij

P(X2 = j) =

�

i,k

λiPi(X1 = k, X2 = j) =

�

i,k

λipikpkj = (λP 2)j.

Continuing in this way,

Pi(Xn = j) = (δiP n)j = (P n)ij = p(n)

ij

P(Xn = j) =

�

i0,...,in−1

λi0pi0i1 · · · pin−1j = (λP n)j.

Thus P (n) = (p(n)

ij ), the n-step transition matrix, is simply P n (P raised to power n).

Also, for all i, j and n, m ≥ 0, the (obvious) Chapman-Kolmogorov equations

hold:

p(n+m)

ij

=

�

k∈I

p(n)

ik p(m)

kj

3


named for their independent formulation by Chapman (a Trinity College graduate,

1880-1970), and Kolmogorov (1903-1987).

In Example 1.1

P (n) =





























0

1

0

0

0

0

0

0

1



2

1



2

0

0

0

0

1



2

0

1



2

0

0

0

0

0

0

1



4

1



2

1



4

0

0

0

0

0

0

0

1



2

1



2

0

0

0

1

0

0

0

0

0

0

0

0

0

1





























n

→





























1



5

2



5

2



5

0

0

0

0

1



5

2



5

2



5

0

0

0

0

1



5

2



5

2



5

0

0

0

0

2



15

4



15

4



15

0

0

0

1



3

1



15

2



15

2



15

0

0

0

2



3

2



15

4



15

4



15

0

0

0

1



3

0

0

0

0

0

0

1





























1.6

P (n) for a two-state Markov chain

Example 1.4 (A two-state Markov chain).

1

2



α

1 − α

β

1 − β

P =

�1 − α

α

β

1 − β

�

The eigenvalues are 1 and 1 − α − β. So we can write

P = U

�1

0

0

1 − α − β

�

U −1

=⇒ P n = U

�1

0

0

(1 − α − β)n

�

U −1

So p(n)

11 = A + B(1 − α − β)n for some A and B.

But p(0)

11 = 1 = A+B and p(1)

11 = 1−α = A+B(1−α−β). So (A, B) = (β, α)/(α+β),

i.e.

P1(Xn = 1) = p(n)

11 =

β



α + β +

α



α + β (1 − α − β)n.

Note that this tends exponentially fast to a limit of β/(α + β).

Other components of P n can be computed similarly, and we have

P n =

�

β



α+β +

α



α+β (1 − α − β)n

α



α+β −

α



α+β (1 − α − β)n

β



α+β −

β



α+β (1 − α − β)n

α



α+β +

β



α+β (1 − α − β)n

�

Note. We might have reached the same answer by arguing:

p(n)

11 = p(n−1)

11

p11 + p(n−1)

12

p21 = p(n−1)

11

(1 − α) +

�

1 − p(n−1)

11

�

β.

This gives the linear recurrence relation

p(n)

11 = β + (1 − α − β)p(n−1)

11

to which the solution is of the form p(n)

11 = A + B(1 − α − β)n.

4


2

Calculation of n-step transition probabilities, class

structure, absorption, and irreducibility

2.1

Example: a three-state Markov chain

Example 2.1.

3

2

1



1

1/2

1/2

P =







0

1

0

0

1



2

1



2

1



2

0

1



2







Now 0 = det(xI − P) = x(x − 1/2)2 − 1/4 = (1/4)(x − 1)(4x2 + 1).

Eigenvalues are 1, ±i/2. This means that

p(n)

11 = A + B(i/2)n + C(−i/2)n.

We make the substitution:

(±i/2)n = (1/2)ne±inπ/2 = (1/2)n�

cos(nπ/2) ± i sin(nπ/2)

�

.

Thus for some B′ and C′,

p(n)

11 = A + (1/2)n�

B′ cos(nπ/2) + C′ sin(nπ/2)

�

.

We then use facts that p(0)

11 = 1, p(1)

11 = 0, p(2)

11 = 0 to ﬁx A, B′ and C′ and get

p(n)

11 = 1



5 +

� 1



2

�n � 4



5 cos nπ



2 − 2



5 sin nπ



2

�

.

Note that the second term is exponentially decaying.

We have p(5)

11 =

3



16,

p(10)

11

=

51



256,

|p(n)

11 − 1/5| &lt; 2−n.

More generally, for chain with m states, and states i and j

(i) Compute the eigenvalues µ1, . . . , µm of the m × m matrix P.

(ii) If the eigenvalues are distinct then p(n)

ij

has the form (remembering that µ1 = 1),

p(n)

ij

= a1 + a2µn

2 + · · · amµn

m

for some constants a1, . . . , am. If an eigenvalue µ is repeated k times then there

will be a term of (b0 + b1n + · · · + bk−1nk−1)µn.

(iii) Complex eigenvalues come in conjugate pairs and these can be written using sins

and cosines, as in the example.

However, sometimes there is a more clever way.

5


2.2

Example: use of symmetry

Example 2.2 (Random walk on vertices of a complete graph). Consider a random

walk on the complete graph K4 (vertices of a tetrahedron), with

P = 1



3









0

1

1

1

1

0

1

1

1

1

0

1

1

1

1

0







 .

Eigenvalues are {1, −1/3, −1/3, −1/3} so general solution is p(n)

11 = A + (−1/3)n(a +

bn + cn2). However, we may use symmetry in a helpful way. Notice that for i ̸= j,

p(n)

ij

= (1/3)(1 − p(n)

ii ). So

p(n)

11 =

�

j̸=1

p1jp(n−1)

j1

= (1/3)

�

1 − p(n−1)

11

�

.

Thus we have just a ﬁrst order recurrence equation, to which the general solution is

of the form p(n)

11 = A + B(−1/3)n. Since A + B = 1 and A + (−1/3)B = 0 we have

p(n)

11 = 1/4 + (3/4)(−1/3)n. Obviously, p(n)

11 → 1/4 as n → ∞.

Do we expect the same sort of thing for random walk on corners of a cube? (No,

p(n)

11 does not tend to a limit since p(n)

11 = 0 if n is odd.)

2.3

Markov property

Theorem 2.3 (Markov property). Let (Xn)n≥0 be Markov(λ, P). Then conditional

on Xm = i, (Xm+n)n≥0 is Markov(δi, P) and is independent of the random variables

X0, X1, . . . , Xm.

Proof (non-examinable). We must show that for any event A determined by X0, . . . , Xm

we have

P({Xm = im, . . . , Xm+n = im+n} ∩ A | Xm = i)

= δiimpimim+1 · · · pim+n−1im+nP(A | Xm = i)

(2.1)

then the result follows from Theorem 1.3. First consider the case of elementary events

like A = {X0 = i0, . . . , Xm = im}. In that case we have to show that

P(X0 = i0, . . . , Xm+n = im+n and i = im)/P(Xm = i)

= δiimpimim+1 · · · pim+n−1im+nP(X0 = i0, . . . , Xm = im and i = im)/P(Xm = i)

which is true by Theorem 1.3. In general, any event A determined by X0, . . . , Xm may

be written as the union of a countable number of disjoint elementary events

A =

∞

�

k=1

Ak.

6


The desired identity (2.1) follows by summing the corresponding identities for the

Ak.









2.4

Class structure

It is sometimes possible to break a Markov chain into smaller pieces, each of which is

relatively easy to understand, and which together give an understanding of the whole.

This is done by identifying communicating classes of the chain.

Recall the initial

example.



1

4

3

7

6

1

2

5



1

1

1/2

1/2

1/2

1/2

1/2

1/2

1/2

1/4

1/4

We say that i leads to j and write i → j if

Pi(Xn = j for some n ≥ 0) &gt; 0.

We say i communicates with j and write i ↔ j if both i → j and j → i.

Theorem 2.4. For distinct states i and j the following are equivalent.

(i) i → j;

(ii) pi0i1pi1i2 · · · pin−1in &gt; 0 for some states i0, i1, . . . , in, where n ≥ 1, i0 = i and

in = j;

(iii) p(n)

ij

&gt; 0 for some n ≥ 1.

Proof. Observe that

p(n)

ij

≤ Pi(Xn = j for some n ≥ 0) ≤

∞

�

n=0

p(n)

ij

which proves the equivalence of (i) and (iii). Also,

p(n)

ij

=

�

i1,...,in−1

pi0i1pii2 · · · pin−1j

so that (ii) and (iii) are equivalent.









7


2.5

Closed classes

It is clear from (ii) that i ↔ j and j ↔ k imply i ↔ k, and also that i ↔ i. So

↔ satisﬁes the conditions for an equivalence relation on I and so partitions I into

communicating classes. We say a C is a closed class if

i ∈ C, i → j =⇒ j ∈ C.

A closed class is one from which there is no escape. A state i is absorbing if {i} is a

closed class.

If C is not closed then it is open and there exist i ∈ C and j ̸∈ C with i → j (you

can escape).

Example 2.5.

Find the classes in P and say whether they are open or closed.

P =



















1



2

1



2

0

0

0

0

0

0

1

0

0

0

1



3

0

0

1



3

1



3

0

0

0

0

1



2

1



2

0

0

0

0

0

0

1

0

0

0

0

1

0



















1

2

3

4

5

6

The solution is obvious from the diagram. The classes are {1, 2, 3}, {4} and {5, 6},

with only {5, 6} being closed.

2.6

Irreducibility

A chain or transition matrix P in which I is a single class is called irreducible. It is

easy to detect. We just have to check that i → j for every i, j.

8


3

Hitting probabilities and mean hitting times

3.1

Absorption probabilities and mean hitting times

Example 3.1.

P =

�

1 − p

p

0

1

�

Let us calculate probability of absorption in state 2.

P1(hit 2) =

∞

�

n=1

P(hit 2 at time n) =

∞

�

n=1

(1 − p)n−1p = 1.

Similarly can ﬁnd mean time to hit state 2:

E1(time to hit 2) =

∞

�

n=1

nP(hit 2 at time n)

=

∞

�

n=1

n(1 − p)n−1p = −p d



dp

∞

�

n=0

(1 − p)n = 1



p.

Alternatively, set h = P1(hit 2), k = E1(time to hit 2). Conditional on the ﬁrst

step,

h = (1 − p)P1(hit 2 | X1 = 1) + pP1(hit 2 | X1 = 2) = (1 − p)h + p =⇒ h = 1

k = 1 + (1 − p)k + p.0 =⇒ k = 1/p.

3.2

Calculation of hitting probabilities and mean hitting times

Let (Xn)n≥0 be a Markov chain with transition matrix P. The ﬁrst hitting time of a

subset A of I is the random variable HA : Ω → {0, 1, . . .} ∪ {∞} given by

HA(ω) = inf{n ≥ 0 : Xn(ω) ∈ A)

where we agree that the inﬁmum of the empty set is ∞. The probability starting from

i that (Xn)n≥0 ever hits A is

hA

i = Pi(HA &lt; ∞).

When A is a closed class, hA

i is called an absorption probability. The mean hitting

time for (Xn)n≥0 reaching A is given by

kA

i = Ei(HA) =

�

n&lt;∞

nPi(HA = n) + ∞P(HA = ∞).

Informally,

hA

i = Pi(hit A),

kA

i = Ei(time to hit A).

Remarkably, these quantities can be calculated from certain simple linear equations.

Let us consider an example.

9


Example 3.2. Symmetric random walk on the integers 0,1,2,3, with absorption at 0

and 3.



1/2

1/2

1/2

1/2

0

1

1

1

2

3

Starting from 2, what is the probability of absorption at 3? How long does it take

until the chain is absorbed in 0 or 3?

Let hi = Pi(hit 3), ki = Ei(time to hit {0, 3}). Clearly,

h0 = 0

h1 = 1



2h0 + 1



2h2

h2 = 1



2h1 + 1



2h3

h3 = 1

k0 = 0

k1 = 1 + 1



2k0 + 1



2k2

k2 = 1 + 1



2k1 + 1



2k3

k3 = 0

These are easily solved to give h1 = 1/3, h2 = 2/3, and k1 = k2 = 2.

Example 3.3 (Gambler’s ruin on 0, . . . , N). Asymmetric random walk on the integers

0, 1, . . ., N, with absorption at 0 and N. 0 &lt; p = 1 − q &lt; 1.

i+1

 

i-1

N-1

N



p

p

p

p

p

q

q

q

q

q

0

1

1

1

i

Let hi = Pi(hit 0). So h0 = 1, hN = 0 and

hi = qhi−1 + phi+1,

1 ≤ i ≤ N − 1.

Characteristic equation is px2 − x + q = (x − 1)(px − q) so roots are {1, q/p} and if

p ̸= q general solution is hi = A + B(q/p)i. Using boundary conditions we ﬁnd

hi = (q/p)i − (q/p)N



1 − (q/p)N

.

If p = q general solution is hi = A + Bi and using boundary conditions we get hi =

1 − i/N.

Similarly, you should be able to show that if p = q, ki = Ei(time to hit {0, N}) =

i(N − i).

10


3.3

Absorption probabilities are minimal solutions to RHEs

For a ﬁnite state space, as examples thus far, the equations have a unique solution.

But if I is inﬁnite there may be many solutions. The absorption probabilities are given

by the minimal solution.

Theorem 3.4. The vector of hitting probabilities hA = (hA

i : i ∈ I) is the minimal

non-negative solution to the system of linear equations

� hA

i = 1

for i ∈ A

hA

i = �

j pijhA

j

for i ̸∈ A

(3.1)

(Minimality means that if x = (xi : i ∈ I) is another solution with xi ≥ 0 then xi ≥ hi

for all i.)

We call (3.1) a set of right hand equations (RHEs) because hA occurs on the r.h.s. of

P in hA = ˜PhA (where ˜P is the matrix obtained by deleting rows for which i ∈ A).

Proof. First we show that hA satisﬁes (3.1). If X0 = i ∈ A, then HA = 0, so hA

i = 1.

If X0 ̸∈ A, then HA ≥ 1, so by the Markov property

hA

i = Pi(HA &lt; ∞) =

�

j∈I

Pi(HA &lt; ∞, X1 = j) =

�

j∈I

Pi(HA &lt; ∞ | X1 = j)Pi(X1 = j)

=

�

j∈I

pijhA

j

�

as Pi(HA &lt; ∞ | X1 = j) = Pj(HA &lt; ∞) = hA

j

�

.

Suppose now that x = (xi : i ∈ I) is any solution to (3.1). Then hA

i = xi = 1 for i ∈ A.

Suppose i ̸∈ A, then

xi =

�

j

pijxj =

�

j∈A

pijxj +

�

j̸∈A

pijxj.

Substitute for xj to obtain

xi =

�

j∈A

pij +

�

j̸∈A

pij



�

k∈A

pjk +

�

k̸∈A

pjkxk





= Pi(X1 ∈ A) + Pi(X1 ̸∈ A, X2 ∈ A) +

�

j,k̸∈A

pijpjkxk

By repeated substitution for x in the ﬁnal terms we obtain

xi = Pi(X1 ∈ A) + Pi(X1 ̸∈ A, X2 ∈ A) + · · · + Pi(X1 ̸∈ A, X2, . . . , Xn−1 ̸∈ A, Xn ∈ A)

+

�

j1,...,jn̸∈A

pij1pj1j2 · · · pjn−1jnxjn.

So since xjn is non-negative, xi ≥ Pi(HA ≤ n). This implies

xi ≥ lim

n→∞ Pi(HA ≤ n) = Pi(HA &lt; ∞) = hi.









11


Notice that if we try to use this theorem to solve Example 3.2 then (3.1) does not

provide the information that h0 = 0 since the second part of (3.1) only says h0 = h0.

However, h0 = 0 follows from the minimality condition.

3.4

Gambler’s ruin

Example 3.5 (Gambler’s ruin on 0, 1, . . .). 0 &lt; p = 1 − q &lt; 1.

ts



p

p

p

p

q

q

q

q

0

1

i − 1

i

i + 1

The transition probabilities are

p00 = 1,

pi,i−1 = q,

pi,i+1 = p

for i = 1, 2, . . .

Set hi = Pi(hit 0), then it is the minimal non-negative solution to

h0 = 1,

hi = phi+1 + qhi−1

for i = 1, 2, . . .

If p ̸= q this recurrence has general solution

hi = 1 − A + A (q/p)i .

We know by Theorem 3.4 that the minimal solution is h, a distribution on {0, 1, . . .}.

If p &lt; q then the fact that 0 ≤ hi ≤ 1 for all i forces A = 0. So hi = 1 for all i.

If p &gt; q then in seeking a minimal solution we will wish to take A as large as

possible, consistent with hi ≥ 0 for all i. So A = 1, and hi = (q/p)i.

Finally, if p = q = 1/2 the recurrence relation has a general solution hi = 1 + Bi,

and the restriction 0 ≤ hi ≤ 1 forces B = 0. Thus hi = 1 for all i. So even if you ﬁnd a

fair casino you are certain to end up broke. This apparent paradox is called gambler’s

ruin.

12


4

Survival probability for birth and death chains,

stopping times and strong Markov property

4.1

Survival probability for birth death chains

Example 4.1. Birth and death chains. Consider the Markov chain with diagram



pi

qi

q1

pi−1

qi+1

p1

0

1

i − 1

i

i + 1

where, for i = 1, 2, . . ., we have 0 &lt; pi = 1 − qi &lt; 1.

State i is that in which a

population is i.

As in previous examples, 0 is an absorbing state and we wish to calculate the

absorption probability starting from state i. So now hi = Pi(hit 0) is the extinction

probability starting from state i. We write down the usual system of r.h. equations

h0 = 1,

hi = pihi+1 + qihi−1

for i = 1, 2, . . .

This recurrence relation has variable coeﬃcients so the usual technique fails.

But

consider ui = hi−1 − hi. Then piui+1 = qiui, so

ui+1 =

� qi



pi

�

ui =

� qiqi−1 · · · q1



pipi−1 · · · p1

�

u1 = γiu1

where the ﬁnal equality deﬁnes γi. Then

u1 + · · · + ui = h0 − hi

so

hi = 1 − u1(γ0 + · · · + γi−1)

where γ0 = 1. At this point u1 remains to be determined. Since we know h is the

minimal solution to the right hand equations, we want to choose u1 to be as large as

possible. In the case �∞

i=0 γi = ∞, the restriction 0 ≤ hi ≤ 1 forces u1 = 1 − h1 = 0

and hi = 1 for all i. But if �∞

i=0 γi &lt; ∞ then we can take u1 &gt; 0 so long as

1 − u1(γ0 + · · · + γi−1) ≥ 0

for all i.

Thus the minimal non-negative solution occurs when u1 = (�∞

i=0 γi)

−1 and then

hi =

∞

�

j=i

γj

�

∞

�

j=0

γj.

In this case, for i = 1, 2, . . ., we have hi &lt; 1, so the population survives with positive

probability.

13


4.2

Mean hitting times are minimal solutions to RHEs

A similar result to Theorem 3.4 can be proved for mean hitting times.

Theorem 4.2.

The vector of mean hitting times kA = (kA

i : i ∈ I) is the minimal

non-negative solution to the system of linear equations

�

kA

i = 0

for i ∈ A

kA

i = 1 + �

j pijkA

j

for i ̸∈ A

(4.1)

Proof. First we show that kA satisﬁes (4.1). If X0 = i ∈ A, then HA = 0, so kA

i = 0.

If X0 ̸∈ A, then HA ≥ 1, so by the Markov property

Ei(HA | X1 = j) = 1 + Ej(HA) = 1 + kA

j

and so for i ̸∈ A,

kA

i =

∞

�

t=1

P(HA ≥ t) =

∞

�

t=1

�

j∈I

P(HA ≥ t | X1 = j)Pi(X1 = j)

=

�

j∈I

∞

�

t=1

P(HA ≥ t | X1 = j)Pi(X1 = j)

=

�

j∈I

Ei(HA | X1 = j)Pi(X1 = j)

=

�

j∈I

pij(1 + kA

j )

= 1 +

�

j∈I

pijkA

j

In the second line above we use the fact that we can swap �

t≥1 and �

j∈I for countable

sums (Fubini’s theorem).

Suppose now that y = (yi : i ∈ I) is any solution to (4.1). Then kA

i = yi = 0 for

i ∈ A. Suppose i ̸∈ A, then

yi = 1 +

�

j̸∈A

pijyj

= 1 +

�

j̸∈A

pij



1 +

�

k̸∈A

pjkyk





= Pi(HA ≥ 1) + Pi(HA ≥ 2) +

�

j,k̸∈A

pijpjkyk.

By repeated substitution we obtain

yi = Pi(HA ≥ 1) + · · · + Pi(HA ≥ n) +

�

j1,...,jn̸∈A

pij1pj1j2 · · · pjn−1jnyjn.

14


So since yjn is non-negative

yi ≥ lim

n→∞[Pi(HA ≥ 1) + · · · + Pi(HA ≥ n)] = Ei(HA) = kA

i .









4.3

Stopping times

The Markov property says that for each time m, conditional on Xm = i, the process

after time m is a Markov chain that begins afresh from i. What if we simply waited

for the process to hit state i at some random time H?

A random variable T : Ω → {0, 1, 2, . . .}∪{∞} is called a stopping time if the event

{T = n} depends only on X0, . . . , Xn for n = 0, 1, 2, . . . . Alternatively, T is a stopping

time if {T = n} ∈ Fn for all n, where this means {T = n} ≡ {(X0, . . . , Xn) ∈ Bn} for

some Bn ∈ In+1.

Intuitively, this means that by watching the process you can tell when T occurs. If

asked to stop at T you know when to stop.

Examples 4.3.

1. The hitting time: Hi = inf{n ≥ 0 : Xn = i} is a stopping time.

2. T = Hi + 1 is a stopping time.

3. T = Hi − 1 is not a stopping time.

4. T = Li = sup{n ≥ 0 : Xn = i} is not a stopping time.

4.4

Strong Markov property

Theorem 4.4 (Strong Markov property). Let (Xn)n≥0 be Markov(λ, P) and let T be

a stopping time of (Xn)n≥0. Then conditional on T &lt; ∞ and XT = i, (XT +n)n≥0 is

Markov(δi, P) and independent of the random variables X0, Xi, . . . , XT .

Proof (not examinable). If B is an event determined by X0, X1, . . . , XT then B ∩ {T =

m} is an event determined by X0, X1, . . . , Xm, so, by the Markov property at time m,

P({XT = j0, XT +1 = j1, . . . , XT +n = jn} ∩ B ∩ {T = m} ∩ {XT = i})

= Pi({X0 = j0, X1 = j1, . . . , Xn = jn})P(B ∩ {T = m} ∩ {XT = i})

where we have used the condition T = m to replace m by T . Now sum over m =

0, 1, 2, . . . and divide by P(T &lt; ∞, XT = i) to obtain

P({XT = j0, XT +1 = j1, . . . , XT +n = jn} ∩ B | T &lt; ∞, XT = i)

= Pi({X0 = j0, X1 = j1, . . . , Xn = jn})P(B | T &lt; ∞, XT = i).









15


Example 4.5 (Gambler’s ruin again). 0 &lt; p = 1 − q &lt; 1.



p

p

p

p

q

q

q

q

0

1

i

i − 1

i + 1

Let hi = Pi(hit 0). Then

h1 = ph2 + q

h2 = h2

1.

The fact that h2 = h2

1 is explained as follows. Firstly, by the strong Markov property

we have that P2(hit 0) = P2(hit 1)P1(hit 0). This is because any path which starts in

state 2 and eventually hits state 0 must at some ﬁrst time hit state 1, and then from

state 1 reach state 0.

Secondly, P2(hit 1) = P1(hit 0). This is because paths that go from 2 to 1 are in

one-to-one correspondence with paths that go from 1 to 0 (just shifted 1 to the right).

So P2(hit 0) = P1(hit 0)2. So h1 = ph2

1 + q and this implies h1 = 1 or = q/p. We

take the minimal solution.

Similarly, let ki = Ei(time to hit 0). Assuming q &gt; p,

k1 = 1 + pk2

k2 = 2k1

(by strong Markov property)

=⇒ k1 = 1/(1 − 2p) = 1/(q − p).

16


5

Recurrence and transience

5.1

Recurrence and transience

Let (Xn)n≥0 be a Markov chain with transition matrix P. Deﬁne

Hi = inf{n ≥ 0 : Xn = i} = hitting time on i

Ti = inf{n ≥ 1 : Xn = i} = ﬁrst passage time to i.

Note that Hi and Ti diﬀer only if X0 = i. Let

Vi =

∞

�

n=0

1{Xn=i} = number of visits to i

fi = Pi(Ti &lt; ∞) = return probability to i

mi = Ei(Ti) = mean return time to i.

We say that i is recurrent if Pi(Vi = ∞) = 1.

Otherwise i is transient.

A

recurrent state is one that one you keep coming back to. A transient state is one that

you eventually leave forever. In fact, as we shortly see, Pi(Vi = ∞) can only take the

values 0 and 1 (not, say, 1/2).

5.2

Equivalence of recurrence and certainty of return

Lemma 5.1. For all k ≥ 0, Pi(Vi ≥ k + 1) = (fi)k.

Proof. This is true for k = 0. Assume it is true for k−1. The kth visit to i is a stopping

time, so by the strong Markov property

Pi(Vi ≥ k + 1) = Pi(Vi ≥ k + 1 | Vi ≥ k)Pi(Vi ≥ k)

= Pi(Ti &lt; ∞)(fi)k−1

= (fi)k.

Hence the lemma holds by induction.









Theorem 5.2. We have the dichotomy

i is recurrent ⇐⇒ fi = 1

i is transient ⇐⇒ fi &lt; 1.

Proof. Observe that

Pi(Vi &lt; ∞) = Pi

� �

k≥1

{Vi = k}

�

=

∞

�

k=1

Pi(Vi = k) =

∞

�

k=1

(1 − fi)f k−1

i

=

�

0,

fi = 1,

1,

fi &lt; 1.

So i is recurrent iﬀ fi = 1, and transient iﬀ fi &lt; 1.









17


5.3

Equivalence of transience and summability of n-step tran-

sition probabilities

Theorem 5.3. We have the dichotomy

i is recurrent ⇐⇒

∞

�

n=0

p(n)

ii

= ∞ ⇐⇒ fi = 1

i is transient ⇐⇒

∞

�

n=0

p(n)

ii

&lt; ∞ ⇐⇒ fi &lt; 1.

Proof. If i is recurrent, this means Pi(Vi = ∞) = 1, and so

∞

�

n=0

p(n)

ii

=

∞

�

n=0

Ei

�

1{Xn=i}

�

= Ei

� ∞

�

n=0

1{Xn=i}

�

= Ei(Vi) = ∞.

If i is transient then (by Theorem 5.2) fi &lt; 1 and

∞

�

n=0

p(n)

ii

= Ei(Vi) =

∞

�

r=0

Pi(Vi &gt; r) =

∞

�

r=0

f r

i =

1



1 − fi

&lt; ∞.









5.4

Recurrence as a class property

Now we can show that recurrence and transience are class properties.

Theorem 5.4. Let C be a communicating class.

Then either all states in C are

transient or all are recurrent.

Proof. Take any pair of states i, j ∈ C and suppose that i is transient. There exists

n, m ≥ 0 with p(n)

ij

&gt; 0 and p(m)

ji

&gt; 0, and, for all r ≥ 0,

p(n+m+r)

ii

≥ p(n)

ij p(r)

jj p(m)

ji

so

∞

�

r=0

p(r)

jj ≤

1



p(n)

ij p(m)

ji

∞

�

r=0

p(n+m+r)

ii

&lt; ∞

and so j is transient by Theorem 5.3









In the light of this theorem it is natural to speak of a recurrent or transient class.

18


The following blue text gives an alternative way to reach the conclusion that recurrence

and transience are class properties. In lectures we will probably omit this. But it is

nice to see the contrast with matrix method used in Theorem 5.4.

Theorem 5.5. Suppose i is recurrent and i → j. Then (a) Pj(Hi &lt; ∞) = 1, (b)

Pi(Hj &lt; ∞) = 1, (c) j is recurrent.

Note that (c) implies that recurrence and transience are class properties (see also

Theorem 5.4). Also, (a) implies that every recurrent class is closed (see also Theo-

rem 5.6).

Proof. (a) By the strong Markov property

0 = Pi(Hi = ∞) ≥ Pi(Hj &lt; ∞)Pj(Hi = ∞).

But Pi(Hj &lt; ∞) &gt; 0 so Pj(Hi = ∞) = 0 =⇒ Pj(Hi &lt; ∞) = 1, which is (a).

(b) Let T (0)

i

= 0 and T (k)

i

be the time of kth return to i. Consider the events

Ak =

�

Xn = j for some T (k−1)

i

&lt; n &lt; T (k)

i

�

. Let ρ = Pi(Ak). The Ak are independent,

so

Pi(Hj &lt; ∞) = Pi

��

k Ak

�

= 1 − Pi

��

k Ac

k

�

=

�

0,

ρ = 0

1,

ρ &gt; 0

Now i → j implies ρ &gt; 0, which forces Pi(Hj &lt; ∞) = 1, which is (b).

Finally, by (a), (b) and the strong Markov property,

Pj(Tj &lt; ∞) ≥ Pj(Hi &lt; ∞)Pi(Hj &lt; ∞) = 1.









5.5

Relation with closed classes

Theorem 5.6. Every recurrent class is closed.

Proof. If C is not closed then there exists i ∈ C and j ̸∈ C with i → j and m ≥ 1 such

that

Pi(Xm = j) &gt; 0.

Now since j ̸→ i,

Pi(Vi = ∞ | Xm = j) = 0

and this implies that

Pi(Vi = ∞) =

�

k

Pi(Vi = ∞ | Xm = k)Pi(Xm = k) &lt; 1.

So i is not recurrent, and so neither is C.









19


Theorem 5.7. Every ﬁnite closed class is recurrent.

Proof. Let C be such a class. Pick any initial distribution on C. Then �

i∈C Vi = ∞.

Since C is ﬁnite some state must be visited inﬁnitely often. So

1 = P

� �

i∈C

{Vi = ∞}

�

≤

�

i∈C

P(Vi = ∞)

So for some i, 0 &lt; P(Vi = ∞) = P(Hi &lt; ∞)Pi(Vi = ∞). But since Pi(Vi = ∞) can

only take values 0 or 1, we must have Pi(Vi = ∞) = 1. Thus i is recurrent, and so also

C is recurrent.









We will need the following result for Theorem 9.8.

Theorem 5.8. Suppose P is irreducible and recurrent. Then for all j ∈ I we have

P(Tj &lt; ∞) = 1.

Proof. By the Markov property we have

P(Tj &lt; ∞) =

�

i∈I

P(X0 = i)Pi(Tj &lt; ∞)

so it suﬃces to show that Pi(Tj &lt; ∞) = 1 for all i ∈ I. Choose m with p(m)

ji

&gt; 0. By

Theorem 5.3 we have

1 = Pj(Xn = j for inﬁnitely many n)

≤ Pj(Xn = j for some n ≥ m + 1)

=

�

k∈I

Pj(Xn = j for some n ≥ m + 1 | Xm = k)Pj(Xm = k)

=

�

k∈I

Pk(Tj &lt; ∞)p(m)

jk

But �

k∈I p(m)

jk

= 1 so we must have Pi(Tj &lt; ∞) = 1.









We conclude with a criterion by which to tell whether an irreducible chain is transient.

Theorem 5.9. An irreducible Markov chain is transient iﬀ for some state i there exists

a nonzero vector y such that yj = �

k̸=i pjkyk, for all j ̸= i, and |yj| ≤ 1 for all j.

*Proof*. If the chain is transient then we may take yj = Pj(Ti &lt; ∞), with 0 &lt; yj &lt; 1.

On the other hand, if there exists a y as described in the theorem statement, then

|yj| ≤ �

k̸=i pjk|yk|. By repeated substitution of this into itself (in the manner of the

proofs of Theorems 3.4 and 4.2) we can show

0 &lt; |yj| ≤

�

k1k2...km̸=i

pjk1pk1k2 . . . pkm−1km = Pj(Ti &gt; m).

Taking a limit as m → ∞ we have Pj(Ti = ∞) &gt; 0 and so the chain is transient.









20


6

Random walks in dimensions one, two and three

6.1

Simple random walk on Z

Example 6.1 (Simple random walk on Z). The simple random walk on Z has diagram



p

p

p

q

q

q

i

i − 1

i + 1

where 0 &lt; p = 1 − q &lt; 1.

Consider f0 = P0(return to 0). Let hi = Pi(hit 0). Then

f0 = qh−1 + ph1.

Using the strong Markov property h1 = q + ph2

1.

The smallest solution is h1 =

min{1, q/p}. So if q = p = 1/2 then h−1 = h1 = 1

=⇒

f0 = 1 and the random

walk is recurrent. But if q &lt; p then h1 &lt; 1, which implies f0 &lt; 1 and transience.

Similarly, if q &gt; p then h−1 &lt; 1 and we have transience.

We may also analyse this random walk using Theorem 5.3 (testing to see whether

�

n p(n)

00 is ﬁnite or inﬁnite. This is more complicated method, but we now do it as a

warm-up for our subsequent analysis of random walk on Z2.

Suppose we start at 0. Obviously, we cannot return to 0 after an odd number of

steps, so p(2n+1)

00

= 0 for all n. Any given sequence of steps of length 2n from 0 to 0

occurs with probability pnqn, there being n steps right and n steps left, and the number

of such sequences is the number of ways of choosing the n right steps from 2n. Thus

p(2n)

00

=

�2n

n

�

pnqn.

Stirling’s approximation provides an approximation to n! for large n: it is known that

n! ∼ A√



n(n/e)n

as n → ∞

for some A ∈ [1, ∞) (we do not need here that A =

√



2π). Thus

p(2n)

00

= (2n)!



(n!)2 (pq)n ∼ (4pq)n



A

�



n/2

as n → ∞.

In the symmetric case p = q = 1/2 we have that 4pq = 1 and so for some N and all

n ≥ N,

p(2n)

00

≥

1



2A√



n

21


so

∞

�

n=N

p(2n)

00

≥ 1



2A

∞

�

n=N

1



√



n = ∞

which show that the random walk is recurrent.

On the other hand, if p ̸= q then

4pq = r &lt; 1, so by a similar argument, for some N,

∞

�

n=N

p(2n)

00

≤ 1



A

∞

�

n=N

rn &lt; ∞

and so the random walk is transient.

6.2

Simple symmetric random walk on Z2

Example 6.2 (Simple symmetric random walk on Z2). The simple random walk on

Z2 has diagram



1



4

1



4

1



4

1



4

and transition probabilities

pij =

�

1/4

if |i − j| = 1

0

otherwise.

Suppose we start at 0. Let us call the walk Xn and write X+

n and X−

n for the projection

of the walk on the diagonal lines y = ±x.



Xn

X−

n

X+

n

Then X+

n and X−

n are independent symmetric random walks on 2−1/2Z, and Xn = 0

if and only if X+

n = 0 = X−

n . This makes clear that for Xn we have

p(2n)

00

=

��2n

n

� �1



2

�2n�2

∼

2



A2n

as n → ∞

22


by Stirling’s formula. Then �∞

n=0 p(n)

00 = ∞ by comparison with �∞

n=0 1/n and the

walk is recurrent.

6.3

Simple symmetric random walk on Z3

Example 6.3 (Simple symmetric random walk on Z3). The transition probabilities

are given by

pij =

�

1/6

if |i − j| = 1

0

otherwise.

Thus the chain jumps to each of its nearest neighbours with equal probability. There

is no easy way to map this into three independent walks on Z as we have done above

for the random walk on Z2 (although see §6.4 below).

Suppose we start at 0. We can only return to zero after an even number of steps,

say 2n. Of these 2n steps there must be i up, i down, j north, j south, k east, k west

for some i, j, k ≥ 0, with i + j + k = n. By counting ways this can be done we get

p(2n)

00

=

�

i,j,k≥0

i+j+k=n

(2n)!



(i!j!k!)2

�1



6

�2n

=

�2n

n

� �1



2

�2n

�

i,j,k≥0

i+j+k=n

� n

i j k

�2 �1



3

�2n

.

Now

�

i,j,k≥0

i+j+k=n

� n

i j k

� �1



3

�n

= 1

the left hand side being the total probability of all the ways of placing n balls in 3

boxes. For the case where n = 3m we have

� n

i j k

�

=

n!



i!j!k! ≤

n!



m!m!m! =

�

n

m m m

�

for all i, j, k, so

p(2n)

00

≤

�2n

n

� �1



2

�2n �

n

m m m

� �1



3

�n

∼

1



2A3

� 6



n

�3/2

as n → ∞.

Hence �∞

m=0 p(6m)

00

&lt; ∞ by comparison with �∞

n=0 n−3/2. But p(6m)

00

≥ (1/6)2p(6m−2)

00

and p(6m)

00

≥ (1/6)4p(6m−4)

00

so for all m we must have

∞

�

n=0

p(n)

00 &lt; ∞

and the walk is transient. In fact, it can be shown that the probability of return to the

origin is about 0.340537329544 . . ..

The above results were ﬁrst proved in 1921 by the Hungarian mathematician George

P´olya (1887–1985).

23


6.4

*A continuized analysis of random walk on Z3*

There is a nice way to analyse the random walk on Z3 that avoids the need for the

intricacies above. Consider six independent processes X+(t), X−(t), Y +(t), Y −(t),

Z+(t), Z−(t).

Each is nondecreasing in continuous time on the states 0, 1, 2, . . .,

making a transition +1 at times that are separated as i.i.d. exponential(1/2) ran-

dom variables. Consequently, successive jumps (in one of the 6 directions) are sepa-

rated as i.i.d. ∼exponential(3) (i.e. as events in a Poisson process of rate 3). Also,

P(X+(t) = i) = (t/2)ie−t/2/i!, and similarly for the others. At time t,

P(X+(t) = X−(t)) =

∞

�

i=0

�

(t/2)ie−t/2/i!

�2

= I0(t)e−t ∼ (2πt)−1/2,

where I0 is a modiﬁed Bessel function of the ﬁrst kind of order 0.

Thus, for this

continuous-time process p00(t) ∼ (2πt)−3/2. Notice that this process observed at its

jump times is equivalent to discrete-time random walk on Z3. Since the mean time be-

tween the jumps of the continuous process is 1/3, we ﬁnd �∞

n=0 p(n)

00 = 3

� ∞

0

p00(t)dt &lt;

∞.

6.5

*Feasibility of wind instruments*

Example 6.4. Lord Rayleigh in “On the theory of resonance” (1899) proposed a model

for wind instruments in which the creation of resonance through a vibrating column of

air requires repeated expansion and contraction of a mass of air at the mouth of the

instrument, air being modelled as an incompressible ﬂuid.

Think instead about an inﬁnite rectangular lattice of cities. City (0,0) wishes to

expand its tax base and does this by inducing a business from a neighboring city to re-

locate to it. The impoverished city does the same (choosing to “beggar-its-neighbour”

randomly amongst its 4 neighbours since “beggars can’t be choosers”), and this con-

tinues, just like a 2-D random walk. Unfortunately, this means that with probability 1

the walk returns to the origin city who eventually ﬁnds that one of its own businesses

is induced away by one of its neighbours, leaving it no better oﬀ than at the start. We

might say that it is “inﬁnitely-hard to expand the tax base by a beggar-your-neighbour

policy”. However, in 3-D there is a positive probability (about 0.66) that the city (0, 0)

will never be beggared by one of its 6 neighbours.

By analogy, we see that in 2-D it will be “inﬁnitely hard” to expand the air at the

mouth of the wind instrument, but in 3-D the energy required is ﬁnite. That is why

Doyle and Snell say wind instruments are possible in our 3-dimensional world, but not

in Flatland.

We will learn in Lecture 12 something more about the method that Rayleigh used

to show that the energy required to create a vibrating column of air in 3-D is ﬁnite.

24


7

Invariant distributions

7.1

Examples of invariant distributions

Many of the long-time properties of Markov chains are connected with the notion of

an invariant distribution or measure. Remember that a measure λ is any row vector

(λi : i ∈ I) with non-negative entries. An measure λ is an invariant measure if

λP = λ. A invariant measure λ is an invariant distribution if �

i λi = 1. The terms

equilibrium, stationary, and steady state are also used to mean the same thing.

Example 7.1. Here are some invariant distributions for some 2-state Markov chains.

P =

� 1



2

1



2

1



2

1



2

�

,

λ = ( 1



2, 1



2),

( 1



2, 1



2)

� 1



2

1



2

1



2

1



2

�

= ( 1



2, 1



2)

P =

� 3



4

1



4

1



4

3



4

�

,

λ = ( 1



2, 1



2),

( 1



2, 1



2)

� 3



4

1



4

1



4

3



4

�

= ( 1



2, 1



2)

P =

� 3



4

1



4

1



2

1



2

�

,

λ = ( 2



3, 1



3),

( 2



3, 1



3)

� 3



4

1



4

1



2

1



2

�

= ( 2



3, 1



3)

(A) Does an invariant measure always exist? Can there be more than one?

(B) Does an invariant distribution always exist? Can there be more than one?

(C) What does an invariant measure or distribution tell me about the chain?

(D) How do I calculate π? (Left hand equations, detailed balance, symmetry).

7.2

Notation

We repeat and add to the notation deﬁnitions in §5.1.

Ti = inf{n ≥ 1 : Xn = i} = ﬁrst passage time to i

mi = Ei(Ti) = mean return time to i

Vi(n) =

n−1

�

k=0

1{Xk=i} = number of visits to i before time n

V k

i = Vi(Tk) = number of visits to i before ﬁrst return to k

γk

i = Ek(V k

i ) = mean number of visits to i between successive visits to k

Notice that if X0 = k then V k

k = 1, and hence γk

k = 1.

25


7.3

What does an invariant measure or distribution tell us?

Suppose π is an invariant distribution and λ is an invariant measure. Under suitable

conditions,

mi = 1



πi

,

γi

j = πj



πi

�

= λj



λi

�

and

P

�Vj(n)



n

→ πj as n → ∞

�

= 1

or, as we say, Vj(n)/n → πj almost surely.

Example 7.2. Consider the two state chain with

P =

�

1 − α

α

β

1 − β

�

Then

P n →

�

β



α+β

α



α+β

β



α+β

α



α+β

�

=

�

π1

π2

π1

π2

�

π = (π1, π2) = (β/(α + β), α/(α + β)) is an invariant distribution.

7.4

Invariant distribution is the solution to LHEs

How do we calculate the πi?

Example 7.3. Consider again Example 2.1.

3

2

1



1

1/2

1/2

P =







0

1

0

0

1



2

1



2

1



2

0

1



2







To ﬁnd an invariant distribution we write down the components of the vector equation

π = πP. (We call these left hand equations (LHEs) as π appears on the left of P.)

π1 = π3 1



2

π2 = π11 + π2 1



2

π3 = π2 1



2 + π3 1



2

The right-hand sides give the probabilities for X1, when X0 has distribution π, and

the equations require X1 also to have distribution π,. The equations are homogeneous

26


so one of them is redundant, and another equation is required to ﬁx π uniquely. That

equation is

π1 + π2 + π3 = 1,

and so we ﬁnd that π = (1/5, 2/5, 2/5). Recall that in Example 2.1

p(n)

11 → 1/5 as n → ∞

so this conﬁrms Theorem 7.6, below. Alternatively, knowing that p(n)

11 has the form

p(n)

11 = a +

�1



2

�n �

b cos nπ



2 + c sin nπ



2

�

we can use Theorem 7.6 and knowledge of π1 to identify a = 1/5, instead of working

out p(2)

11 in Example 2.1.

Alternatively, we may sometimes ﬁnd π from the detailed balance equations

πipij = πjpji for all i, j. If these equations have a solution then it is an invariant

distribution for P (since by summing on j we get πj = �

j πjpji). For example, in

Example 7.2 the detailed balance equation is π1α = π2β. Together with π1 + π2 = 1

this gives π = (β, α)/(α + β). We will say more about this in Lecture 11.

Example 7.4. Consider a success-run chain on {0, 1, . . .}, whose transition proba-

bilities are given by pi,i+1 = pi, pi0 = qi = 1 − pi.



0

1

i

i + 1

i − 1

p0

p1

pi

pi−1

q1

qi

qi+1

qi−1

Then the left-hand (invariant measure equations) read

π0 =

∞

�

i=0

πiqi

=⇒ p0π0 =

∞

�

i=1

πiqi

πi = πi−1pi−1,

for i ≥ 1.

Let r0 = 1, ri = p0p1 · · · pi−1. So πi = riπ0.

We now show that an invariant measure may not exist.

Suppose we choose pi

converging suﬃciently rapidly to 1 so that

r :=

∞

�

i=0

pi &gt; 0

(which is equivalent to

∞

�

i=0

qi &lt; ∞.)

27


So qiπi = (1 − pi)riπ0 = (ri − ri+1)π0. Also

π0 =

∞

�

i=0

πiqi = lim

n→∞

n

�

i=0

πiqi = lim

n→∞

n

�

i=0

(ri − ri+1)π0

= lim

n→∞(r0 − rn+1)π0 = (1 − r)π0

so π0 = 0 and there is no invariant measure.

7.5

Stationary distributions

The following result explains why invariant distributions are also called stationary

distributions.

Theorem 7.5. Let (Xn)n≥0 be Markov(λ, P) and suppose that λ is invariant for P.

Then (Xm+n)n≥0 is also Markov(λ, P).

Proof. By the Markov property we have P(Xm = i) = (λP m)i = λi for all i, and

clearly, conditional on Xm+n = i, Xm+n+1 is independent of Xm, Xm+1, . . . , Xm+n

and has distribution (pij : j ∈ I)









7.6

Equilibrium distributions

The next result explains why invariant distributions are also called equilibrium dis-

tributions.

Theorem 7.6. Let I be ﬁnite. Suppose for some i ∈ I that

p(n)

ij

→ πj

for all j ∈ I.

Then π = (πj : j ∈ I) is an invariant distribution.

Proof. We have

�

j∈I

πj =

�

j∈I

lim

n→∞ p(n)

ij

= lim

n→∞

�

j∈I

p(n)

ij

= 1

and

πj = lim

n→∞ p(n)

ij

= lim

n→∞

�

k∈I

p(n)

ik pkj =

�

k∈I

lim

n→∞ p(n)

ik pkj =

�

k∈I

πkpkj

where we have used ﬁniteness of I to justify interchange of summation and limit oper-

ations. Hence π is an invariant distribution.









Notice that for any of the symmetric random walks discussed previously we have

p(n)

ij

→ 0 as n → ∞ for all i, j ∈ I. The limit is certainly invariant, but it is not a

distribution. Theorem 7.6 is not a very useful result but it serves to indicate a relation-

ship between invariant distributions n-step transition probabilities. In Theorem 9.8 we

shall prove a sort of converse, which is much more useful.

28


8

Existence and uniqueness of invariant distribution,

mean return time, positive and null recurrence

8.1

Existence and uniqueness up to constant multiples

Example 8.1 (Non-uniqueness of invariant distribution).

P =

�1

0

0

1

�

All distributions are invariant. (Example Sheet 2 has a less trivial example.)

Example 8.2 (Non-uniqueness with irreducibility). Suppose p ̸= q.



p

p

p

q

q

q

i

i − 1

i + 1

πi = πi−1p + πi+1q

Set λi = 1, µi = (p/q)i, i ∈ Z. Then both λ and µ are invariant measures. However,

this Markov chain is transient.

The next theorem shows that an invariant measure such that λi = 1 for some i must

have 0 &lt; λj &lt; ∞ for all j.

Theorem 8.3. Suppose P is irreducible and λ ≥ 0 and λ = λP. Then λ ≡ 0 or

(0 &lt; λi &lt; ∞ for all i) or λ ≡ ∞.

Proof. λ = λP = λP n. Given i, j there exists n with p(n)

ij

&gt; 0 (since irreducible) so

λj =

�

k

λkp(n)

kj ≥ λip(n)

ij

So λj &lt; ∞ =⇒ λi &lt; ∞ and λi &gt; 0 =⇒ λj &gt; 0.









In the next two results we shall show that every irreducible and recurrent stochastic

matrix P has an essentially unique positive invariant measure. The proofs rely heavily

on the probabilistic interpretation so it is worth noting at the outset that, for a ﬁnite

state-space I, the existence of an invariant row vector is a simple piece of linear algebra:

the row sums of P are all 1, so the column vector of ones is an eigenvector with

eigenvalue 1, so P must also have a row eigenvector with eigenvalue 1.

Recall that for a ﬁxed state k, we deﬁne for each i the expected time spent in i

between visits to k:

γk

i = Ek

Tk−1

�

n=0

1{Xn=i}.

29


Here the sum of indicator functions counts the number of times at which Xn = i before

the ﬁrst passage to k at time Tk.

Theorem 8.4 (Existence of an invariant measure). Let P be irreducible and recurrent.

Then

(i) γk

k = 1.

(ii) γk = (γk

i : i ∈ I) satisﬁes γkP = γk.

(iii) 0 &lt; γk

i &lt; ∞ for all i.

Proof. (i) is obvious.

(ii) For n = 1, 2, . . . the event {n ≤ Tk} depends only on

X0, . . . , Xn−1 so, by the Markov property at n − 1,

Pk(Xn−1 = i, Xn = j and n ≤ Tk) = Pk(Xn−1 = i and n ≤ Tk)pij.

(8.1)

Since P is recurrent, we have Pk(Tk &lt; ∞) = 1. This means that we can partition the

entire sample space by events of the form {Tk = t}, t = 1, 2, . . . . Also, X0 = XTk = k

with probability 1. So for all j (including j = k)

γk

j = Ek

Tk

�

n=1

1{Xn=j}

= Ek

∞

�

t=1

t

�

n=1

1{Xn=j and Tk=t} = Ek

∞

�

n=1

∞

�

t=n

1{Xn=j and Tk=t}

= Ek

∞

�

n=1

1{Xn=j and n≤Tk}

(since Tk is ﬁnite)

=

�

i∈I

∞

�

n=1

Pk(Xn−1 = i, Xn = j and n ≤ Tk)

=

�

i∈I

pij

∞

�

n=1

Pk(Xn−1 = i and n ≤ Tk)

(using here (8.1))

=

�

i∈I

pijEk

∞

�

n=1

1{Xn−1=i and n≤Tk}

=

�

i∈I

pijEk

∞

�

m=0

1{Xm=i and m≤Tk−1}

=

�

i∈I

pijEk

Tk−1

�

m=0

1{Xm=i} =

�

i∈I

γk

i pij

The bit in blue is sort of optional, but is to help you to see how we are using the

assumption that Tk is ﬁnite, i.e. Pk(Tk &lt; ∞) = 1.

(iii) Since P is irreducible, for each i there exists n, m ≥ 0 with p(n)

ik , p(m)

ki

&gt; 0. Then

γk

i ≥ γk

kp(m)

ki

&gt; 0 and γk

i p(n)

ik ≤ γk

k = 1 by (i) and (ii).









30


Theorem 8.5 (Uniqueness of an invariant measure). Let P be irreducible and let λ be

an invariant measure for P with λk = 1. Then λ ≥ γk. If in addition P is recurrent,

then λ = γk.

Proof. For each j ∈ I we have

λj =

�

i0∈I

λi0pi0j = pkj +

�

i0̸=k

λi0pi0j

= pkj +

�

i0̸=k

pki0pi0j +

�

i0,i1̸=k

λi1pi1i0pi0j

...

= pkj +

�

i0̸=k

pki0pi0,j +

�

i0,i1̸=k

pki1pi1i0pi0,j

+ · · · +

�

i0,...,in−1̸=k

pkin−1 · · · pi1i0pi0j +

�

i0,...,in̸=k

λinpinin−1 · · · pi1i0pi0j

≥ Pk(X1 = j and Tk ≥ 1) + Pk(X2 = j and Tk ≥ 2) + · · · + Pk(Xn = j and Tk ≥ n)

→ γk

j as n → ∞.

So λ ≥ γk. If P is recurrent, then γk is invariant by Theorem 8.4, so µ = λ − γk is also

invariant and µ ≥ 0. Since P is irreducible, given i ∈ I, we have p(n)

ik &gt; 0 for some n,

and 0 = µk = �

j µjp(n)

jk ≥ µip(n)

ik , so µi = 0.









8.2

Mean return time, positive and null recurrence

Recall that a state is recurrent if Pi(Vi = ∞) = 1, i.e.

Pi(Xn = i for inﬁnitely many n) = 1.

We showed in Theorem 5.3 that this is equivalent to fi = 1, i.e.

Pi(Ti &lt; ∞) = 1.

If in addition, the mean return time (or expected return time)

mi = Ei(Ti)

is ﬁnite, then we say that i is positive recurrent. A recurrent state that fails to have

this property is called null recurrent, i.e. mi = ∞.

We show in the next lecture that the following trichotomy holds for an irreducible

Markov chain:

• P is transient;

• P is null-recurrent with mi = ∞ for all i;

• P is positive-recurrent with an invariant distribution π, and mi (= 1/πi) &lt; ∞

for all i.

31


8.3

Random surfer

Example 8.6 (Random surfer and PageRank). The designer of a search engine trys

to please three constituencies: searchers (who want useful search results), paying ad-

vertisers (who want to see ‘click throughs’), and the search provider itself (who wants

to maximize advertising revenue). The order in which search results are listed is a very

important part of the design.

Google PageRank lists search results according to the probabilities with which a

person randomly clicking on links will arrive at any particular page.

Let us model the web as a graph G = (V, E) in which the vertices of the graph

correspond to web pages. Suppose |V | = n. There is a directed edge from i to j if and

only if page i contains a link to page j. Imagine that a random surfer jumps from his

current page i by randomly choosing an outgoing link from amongst the L(i) links if

L(i) &gt; 0, or if L(i) = 0 chooses a random page. Let

ˆpij =

�

1/L(i)

if L(i) &gt; 0 and (i, j) ∈ E,

1/n

if L(i) = 0.

To avoid the possibility that ˆP = (ˆpij) might not be irreducible or aperiodic (a com-

plicating property that we discuss in the next lecture) we make a small adjustment,

choosing α ∈ [0, 1), and set

pij = αˆpij + (1 − α)(1/n).

In other words, we imagine that at each click the surfer chooses with probability α a

random page amongst those that are linked from his current page (or a random page if

there are no such links), and with probability 1 − α chooses a completely random page.

The invariant distribution satisfying πP = π tells us the proportions of time that a

random surfer will spend on the various pages. So if πi &gt; πj then i is more important

than page j and should be ranked higher.

The solution of πP = π was at the heart of Google’s (original) page-ranking algo-

rithm. In fact, it is not too diﬃcult to estimate π because P n converges very quickly

to its limit

Π = 1π⊤ =











π1

π2

· · ·

πn

π1

π2

· · ·

πn

...

...

π1

π2

· · ·

πn











These days the ranking algorithm is more complicated and a trade secret.

32


9

Convergence to equilibrium for ergodic chains

9.1

Equivalence of positive recurrence and the existence of an

invariant distribution

Theorem 9.1. Let P be irreducible. Then the following are equivalent:

(i) every state is positive recurrent;

(ii) some state i is positive recurrent;

(iii) P has an invariant distribution, π say.

Moreover, when (iii) holds we have mi = 1/πi for all i.

Proof. (i) =⇒ (ii) is obvious.

(ii) =⇒ (iii) If i is positive recurrent, it is certainly recurrent, so P is recurrent. By

Theorem 8.4, γi is then invariant. But

�

j∈I

γi

j = mi &lt; ∞

so πk = γi

k/mi deﬁnes an invariant distribution.

(iii) =⇒ (i) Since �

i∈I πi = 1 we have ∞ &gt; πk &gt; 0 for some k. By Theorem 8.3

we must therefore have πk &gt; 0 for all k.

(Alternatively, for any k, we must have

πk = �

i∈I πip(n)

ik &gt; 0 for some n.) Pick any k. Set λi = πi/πk. Then λ is an invariant

measure with λk = 1 So by Theorem 8.5, λ ≥ γk. Hence

mk =

�

i∈I

γk

i ≤

�

i∈I

πi



πk

= 1



πk

&lt; ∞

(9.1)

and so k is positive recurrent for all k, which is (i).

Finally, we have just shown that (iii) implies that P is recurrent. So by Theorem 8.5

λ = γk and the inequality (9.1) is in fact an equality. Thus mk = 1/πk.









Example 9.2 (Simple symmetric random walk on Z). The simple symmetric random

walk on Z is clearly irreducible, and by Example 6.1 it is recurrent.

Consider the

measure λi = 1 for all i. Then λi = λi−1(1/2) + λi+1(1/2) and so λ is invariant. Any

invariant distribution must be a scalar multiple of λ. Since �

i∈I λi = ∞ there can be

no invariant distribution and so the walk is null recurrent.

Example 9.3. The existence of an invariant measure, does not guarantee recurrence.

Consider, for example, the simple symmetric random walk on Z3, which is transient,

but has invariant measure λ given by λi = 1 for all i.

33


9.2

Aperiodic chains

We next turn to an investigation of the limiting behaviour of the n-step transition

probabilities p(n)

ij

as n → ∞. As we saw in Theorem 7.6, if the state-space is ﬁnite

and if for some i the limit p(n)

ij

→ πj exists for all j, then π must be an invariant

distribution. But, as the following example shows, the limit does not always exist.

Example 9.4. Consider the two-state chain with transition matrix

P =

�0

1

1

0

�

Then P 2 = I = P 2n and P 2n+1 = P. Thus p(n)

ij

fails to converge for all i, j.

Let us call a state i aperiodic if p(n)

ii

&gt; 0 for all suﬃciently large n. The behaviour

of the chain in Example 9.4 is connected with its periodicity.

Lemma 9.5. A state i is aperiodic if there exist n1, . . . , nk ≥ 1, k ≥ 2, with no common

divisor and such that p(nj)

ii

&gt; 0, for all j = 1, . . . , k.

Proof. For all suﬃciently large n we can write n = a1n1 + · · · + aknk using some

non-negative integers a1, . . . , ak. So then

p(n)

ii

≥ p(n1)

ii

· · · p(n1)

ii

�



��



�

a1 times

p(n2)

ii

· · · p(n2)

ii

�



��



�

a2 times

· · · p(nk)

ii

· · · p(nk)

ii

�



��



�

ak times

&gt; 0.









Similarly, if d is the greatest common divisor of all those n for which p(n)

ii

&gt; 0

and d ≥ 2, then for all n that are suﬃciently large and divisible by d we can write

n = a1n1 + · · · + aknk for some n1, . . . , nk such that p(n1)

ii

· · · p(nk)

ii

&gt; 0. It follows that

for all n suﬃciently large p(n)

ii

&gt; 0 if and only if n is divisible by d. This shows that

such a state i which is not aperiodic is rightly called periodic, with period d. One can

also show that if two states communicate then they must have the same period.

Lemma 9.6. Suppose P is irreducible, and has an aperiodic state i. Then, for all states

j and k, p(n)

jk &gt; 0 for all suﬃciently large n. In particular, all states are aperiodic.

Proof. There exist r, s &gt; 0 with p(r)

ji , p(s)

ik &gt; 0. Then

p(r+n+s)

jk

≥ p(r)

ji p(n)

ii p(s)

ik &gt; 0

for all suﬃciently large n.









A Markov chain is called a regular chain if some power of the transition matrix

has only positive elements. We have shown above that if a ﬁnite state space Markov

chain is aperiodic and irreducible then it is regular.

An aperiodic, irreducible and positive recurrent Markov chain is called an ergodic

chain. Theorem 9.8 is about ergodic chains.

34


9.3

Convergence to equilibrium *and proof by coupling*

We begin this section with a magic trick.

Example 9.7. (from Grinstead and Snell’s ‘Introduction to Probability’, 2nd edition,

page 452, also in Grimmett and Stirzaker)

Here is a trick to try on your friends. Shuﬄe a deck of cards and deal them out one

at a time. Count the face cards each as ten. Ask your friend to look at one of the ﬁrst

ten cards; if this card is a six, she is to look at the card that turns up six cards later;

if this card is a three, she is to look at the card that turns up three cards later, and so

forth. Eventually she will reach a point where she is to look at a card that turns up

x cards later but there are not x cards left. You then tell her the last card that she

looked at even though you did not know her starting point. You tell her you do this

by watching her, and she cannot disguise the times that she looks at the cards. In fact

you just do the same procedure and, even though you do not start at the same point

as she does, you will most likely end at the same point. Why?

Using a computer, I have simulated this game 10,000 times. In each game I have

computed whether or not two players ﬁnish with the same last card, doing this for

each of the 100 possible pairs of their initial choices of numbers. Between games I have

shuﬄed the pack of cards by applying a random number of in- and out-shuﬄes that

are chosen by a simulations of 20–100 Bernoulli trials. I ﬁnd that the probability that

the two players’ last cards match one another is about 0.85. This increases to 0.90 if

using two decks of cards and 0.96 with four decks of cards.

The proof of Theorem 9.8 that now follows has similarities to the magic trick in

that it works by coupling two Markov chains. It is beautiful and ingenious. I like what

J. Michael Steele says:

Coupling is one of the most powerful of the “genuinely probabilistic” techniques.

Here by “genuinely probabilistic” we mean something that works directly with random

variables rather than with their analytical co-travelers (like distributions, densities, or

characteristic functions).

If you understand the proof of Theorem 9.8 and have a good picture what is going on

in your mind, then I think you are developing excellent intuitive probabilistic insight.

Theorem 9.8 (Convergence to equilibrium). Let P be the transition matrix of an

ergodic Markov chain (i.e. irreducible, aperiodic and positive recurrent), with invariant

distribution π. Then (for any initial distribution) P(Xn = j) → πj as n → ∞ for all

j. In particular

p(n)

ij

→ πj as n → ∞ for all i, j.

Proof. We use a coupling argument that is due to French mathematician Vincent

Doblin (1937). Let (Xn)n≥0 be and (Yn)n≥0 be independent and Markov(λ, P) and

Markov(π, P), respectively.

Fix a reference state b and set T = inf{n ≥ 1 : Xn = Yn = b}.

35


Step 1. We show P(T &lt; ∞) = 1. To see this, observe that process Wn = (Xn, Yn) is

a Markov chain on I × I with transition probabilities

˜p(i,k)(j,ℓ) = pijpkℓ

and initial distribution

µ(i,k) = λiπk.

Since P is aperiodic, for all states i, j, k, ℓ we have

˜p(n)

(i,k)(j,ℓ) = p(n)

ij p(n)

kℓ &gt; 0

for suﬃciently large n, so ˜P is irreducible. Also, ˜P has an invariant distribution of

˜π(i,k) = πiπk.

So by Theorem 9.1, ˜P is positive recurrent. But T is the ﬁrst passage time of Wn to

(b, b) and so P(T &lt; ∞) = 1 by Theorem 5.8.

Step 2.

P(Xn = i) = P(Xn = i, n ≥ T ) + P(Xn = i, n &lt; T )

= P(Yn = i, n ≥ T ) + P(Xn = i, n &lt; T )

= P(Yn = i, n ≥ T ) + P(Yn = i, n &lt; T ) − P(Yn = i, n &lt; T )

+ P(Xn = i, n &lt; T )

= P(Yn = i) − P(Yn = i, n &lt; T ) + P(Xn = i, n &lt; T )

= πi − P(Yn = i, n &lt; T ) + P(Xn = i, n &lt; T )

where the second line follows from XT = YT , and the last line follows from fact that

the initial distribution of Y0 is the invariant distribution.

Now P(Yn = i, n &lt; T ) ≤ P(n &lt; T ) and P(n &lt; T ) → P(T = ∞) = 0 as n → ∞.

Hence P(Yn = i, n &lt; T ) → 0.

Similarly, P(Xn = i, n &lt; T ) → 0.

This proves

P(Xn = i) → πi.









To understand this proof one should see what goes wrong when P is not aperiodic.

Consider the two-state chain of Example 9.4 which has (1/2, 1/2) as its unique invariant

distribution. We start (Xn)n≥0 from 1 and (Yn)n≥0 with equal probability from 1 or 2.

However, if Y0 = 2, then, because of periodicity, (Xn)n≥0 and (Yn)n≥0 will never meet,

and the proof fails.

36


10

Long-run proportion of time spent in given state

10.1

Ergodic theorem

Theorem 10.1 (Strong law of large numbers). Let Y1, Y2 . . . be a sequence of indepen-

dent and identically distributed non-negative random variables with E(Yi) = µ. Then

P

�Y1 + · · · + Yn



n

→ µ as n → ∞

�

= 1.

We do not give a proof.

Recall the deﬁnition Vi(n) = �n−1

k=0 1{Xk=i} =number of visits to i before time n.

Theorem 10.2 (Ergodic theorem). Let P be irreducible and let λ be any distribution.

Suppose (Xn)0≤n≤N is Markov(λ, P). Then

P

�Vi(n)



n

→ 1



mi

as n → ∞

�

= 1

where mi = Ei(Ti) is the expected return time to state i.

Moreover, in the positive recurrent case, for any bounded function f : I → R we

have

P

�

1



n

n−1

�

k=0

f(Xk) → ¯f as n → ∞

�

= 1

where

¯f =

�

i

πif(i)

and where (πi : i ∈ I) is the unique invariant distribution.

Notice that for this result we do not need P to be aperiodic.

Proof. We prove only the ﬁrst part. If P is transient, then, with probability 1, the total

number Vi of visits to i is ﬁnite, so

Vi(n)



n

≤ Vi



n → 0 = 1



mi

.

Suppose that P is recurrent and ﬁx a state i. For T = Ti we have P(T &lt; ∞) = 1 by

Theorem 5.8 and (XT + n)n≥0 is Markov(δi, P) and independent of X0, X1, . . . , XT by

the strong Markov property. The long-run proportion of time spent in i is the same for

(XT +n)n≥0 and (Xn)n≥0 so it suﬃces to consider the case λ = δi.

Recall that the ﬁrst passage time to state i is a random variable Ti deﬁned by

Ti(ω) = inf{n ≥ 1 : Xn(ω) = i}

37


where inf ∅ = ∞. We now deﬁne inductively the rth passage time T (r)

i

to state i by

T (0)

i

(ω) = 0,

T (1)

i

(ω) = Ti(ω),

and for r = 0, 1, 2, . . .

T (r+1)

i

(ω) = inf{n ≥ T (r)

i

(ω) + 1 : Xn(ω) = i}.

The length of the rth excursion is then

S(r)

i

=

�

T (r)

i

− T (r−1)

i

if T (r−1)

i

&lt; ∞

0

otherwise.



0

1

2

i

i

i

i

i

i

j

j

j

k

k

k

n − 1

n

ℓ

ℓ

S(1)

i

S(2)

i

S(3)

i

S(Vi(n)−1)

i

S(Vi(n))

i

Write S(r)

i

for the length of the rth excursion to i. One can see, using the strong Markov

property, that the non-negative random variables S(1)

i

, S(2)

i

, . . . are independent and

identically distributed with Ei(S(r)

i

) = mi. Now

S(1)

i

+ · · · + S(Vi(n)−1)

i

≤ n − 1,

the left-hand side being the time of the last visit to i before n. Also

S(1)

i

+ · · · + S(Vi(n))

i

≥ n,

the left-hand side being the time of the ﬁrst visit to i after n − 1. Hence

S(1)

i

+ · · · + S(Vi(n)−1)

i



Vi(n)

≤

n



Vi(n) ≤ S(1)

i

+ · · · + S(Vi(n))

i



Vi(n)

.

(10.1)

By the strong law of large numbers

P

�

S(1)

i

+ · · · + S(n)

i



n

→ mi as n → ∞

�

= 1

and, since P is recurrent

P (Vi(n) → ∞ as n → ∞) = 1.

So letting n → ∞ in (10.1), we get

P

�

n



Vi(n) → mi as n → ∞

�

= 1.

which implies

P

�Vi(n)



n

→ 1



mi

as n → ∞

�

= 1.









38


10.2

*Kemeny’s constant and the random target lemma*

In this section we explore a bit further the calculation of mean recurrence times. Deﬁne

mij = Ei(Tj) = Ei(inf{n ≥ 1 : Xn = j})

so mii = mi. How can we compute these mean recurrence times?

Throughout this section we suppose that the Markov chain is irreducible and positive

recurrent. Suppose (Xn)n≥0 is Markov(δi, P) and (Yn)n≥0 is Markov(π, P), where π is

the invariant distribution. Deﬁne

zij := Ei

� ∞

�

n=0

�

1{Xn=j} − 1{Yn=j}

�

�

=

∞

�

n=0

(p(n)

ij − πj).

(10.2)

An application of the coupling idea (that eventually Xn = Yn) can be used to show

that this sum is ﬁnite. Then

zij = Ei





Tj−1

�

n=0

(1{Xn=j} − πj)



 + Ej





∞

�

n=Tj

(1{Xn=j} − πj)





= δij − πjEi(Tj) + zjj.

Hence by putting i = j we get mi = Ei(Ti) = 1/πi, as we have seen before. For i ̸= j,

mij = Ei(Tj) = zjj − zij



πj

.

(10.3)

We will ﬁgure out how to compute the zij shortly. First, let us consider the question

of how long it takes to reach equilibrium. Suppose j is a random state that is chosen

according to the invariant distribution. Then starting from state i, the expected number

of steps required to hit state j (possibly 0 if i = j) is

�

j̸=i

πjEi(Tj) =

�

j̸=i

(zjj − zij) =

�

j

(zjj − zij) =

�

j

zjj

(10.4)

since from (10.2) we see that �

j zij = 0. The right hand side of (10.4) is (surprisingly!)

a constant K (called Kemeny’s constant) which is independent of i. This is known

as the random target lemma. There is a nice direct proof also.

Lemma 10.3 (random target lemma). Starting in state i, the expected time of hit-

ting a state j that is chosen randomly according to the invariant distribution, is

�

j̸=i πjEi(Tj) = K (a constant independent of i).

Proof. We wish to compute ki = �

j πjmij − πimi. The ﬁrst step takes us 1 closer to

the target state, unless (with probability πi) we start in the target. So

ki = 1 +

�

j

pijkj − πimi =

�

j

pijkj.

39


Writing k = (k1, . . . , kn), this says k = Pk. Since each ki is some weighted-average of

k1, . . . , kn we see that ki must be a constant, say ki = K.









Now we show how to compute the matrix Z = (zij).

Let Π be the matrix in which each row is π. Suppose that the Markov chain is

ergodic (aperiodic, irreducible and positive recurrent). Then we know that P n → Π.

It is easy to see that ΠP = PΠ = ΠΠ = Π and so (P − Π)k = (P k − Π). Let us deﬁne

¯Z by

¯Z := Z + Π = I + (P − Π) + (P 2 − Π) + · · ·

(10.5)

= I + (P − Π) + (P − Π)2 + · · ·

= (I − (P − Π))−1.

The right hand side of (10.5) converges since each terms is growing closer to 0

geometrically fast. Equivalently, we see that (I − P + Π) is non-singular and so has an

inverse. For if there were to exist x such that (I − P + Π)x = 0 then π(I − P + Π)x =

πx− πx− πx = 0 =⇒ πx = 0 =⇒ Πx = 0 =⇒ (I − P)x = 0. The only way this can

happen is if x is a constant vector (by the same argument as above that k = Pk implies

k is a constant vector). Since π has only positive components this implies x = 0.

We have seen in (10.3) that mij = (zij −zjj)/πj, and in (10.4) that K = trace(Z) =

trace( ¯Z) − trace(Π) = trace( ¯Z) − 1. The eigenvalues of ¯Z are the reciprocals of the

eigenvalues of ¯Z−1 = I − P + Π, and these are the same as 1, 1 − λ2, . . . , 1 − λN, where

1, λ2, . . . , λN are the eigenvalues of P (assuming there are N states). Since the trace

of a matrix is the sum of its eigenvalues,

K =

N

�

i=2

1



1 − λi

.

Recall that in the two-state chain of Example 1.4 the eigenvalues are (1, 1 − α − β).

So in this chain K = 1/(α + β).

40


11

Time reversal, detailed balance, reversibility, ran-

dom walk on a graph

11.1

Time reversal

For Markov chains, the past and future are independent given the present. This prop-

erty is symmetrical in time and suggests looking at Markov chains with time running

backwards. On the other hand, convergence to equilibrium shows behaviour which is

asymmetrical in time: a highly organised state such as a point mass decays to a disor-

ganised one, the invariant distribution. This is an example of entropy increasing. So

if we want complete time-symmetry we must begin in equilibrium. The next result

shows that a Markov chain in equilibrium, run backwards, is again a Markov chain.

The transition matrix may however be diﬀerent.

Theorem 11.1. Let P be irreducible and have an invariant distribution π. Suppose that

(Xn)0≤n≤N is Markov(π, P) and set Yn = XN−n. Then (Yn)0≤n≤N is Markov(π, ˆP )

where ˆP is given by

πj ˆpji = πipij

and P is also irreducible with invariant distribution π.

Proof. First we check that ˆP is a stochastic matrix:

�

i

ˆpji = 1



πj

�

i

πipij = 1

since π is invariant for P. Next we check that π is invariant for ˆP:

�

j∈I

πj ˆpji =

�

j∈I

πipij = πi

since P is a stochastic matrix.

We have

P(Y0 = i0, Y1 = i1, . . . , YN = iN) = P(X0 = iN, X1 = iN−1, . . . , XN = i0)

= πiN piN iN−1 · · · pi1i0

= πi0 ˆpi0i1 · · · ˆpiN−1iN

so by Theorem 1.3 (Yn)0≤n≤N is Markov(π, ˆP ).

Finally, since P is irreducible, for each pair of states i, j, there is a chain of states

i0 = i, ii, . . . , in−1, in = j with pi0i1 · · · pin−1in &gt; 0. So

ˆpinin−1 · · · ˆpin−1in = πi0pi0i1 · · · ˆpin−1in/πin &gt; 0

and thus ˆP is also irreducible.









41


11.2

Detailed balance

A stochastic matrix P and a measure λ are said to be in detailed balance if

λipij = λjpji for all i, j.

Though obvious, the following result is worth remembering because when a solution λ

to the detailed balance equations exists, it is often easier to ﬁnd by the detailed balance

equations than by the equation λ = λP.

Lemma 11.2. If P and λ are in detailed balance, then λ is invariant for P.

Proof. We have (λP)i = �

j λjpji = �

j λipij = λi.









Examples 11.3. (a) A two-state chain like P =

�

1/2

1/2

2/3

1/3

�

.

(b) Any walk on 0, . . . , N with (pi,i−1, pi,i+1) = (qi, pi):



pi

qi

p0

qN

0

N

N − 1

1

i − 1

i

i + 1

We have πipi = πi+1qi+1 =⇒ πi = pi−1 · · · p0



qi · · · q1

π0.

(c) Consider walk on a triangle with

P =





0

a

1 − a

1 − a

0

a

a

1 − a

0





3

2

1



a

a

a

1 − a

1 − a

1 − a

Detailed balance equations are

π1a = π2(1 − a)

π2a = π3(1 − a)

π3a = π1(1 − a)

So there is a solution if a = 1/2. But not if a ̸= 1/2.

42


11.3

Reversibility

Let (Xn)n≥0 be Markov(λ, P), with P irreducible. We say that (Xn)n≥0 is reversible

if, for all N ≥ 1, (XN−n)0≤n≤N is also Markov(λ, P).

Theorem 11.4. Let P be an irreducible stochastic matrix and let λ be a distribution.

Suppose that (Xn)n≥0 is Markov(λ, P). Then the following are equivalent:

(a) (Xn)n≥0 is reversible;

(b) P and λ are in detailed balance.

Proof.

(a) ⇐⇒







XN has distribution λ for all N

and

ˆpij = (λj/λi)pji = pij for all i, j





 ⇐⇒ (b)









11.4

Random walk on a graph

Example 11.5. Random walk on the vertices of a graph G = (V, E). The states are

the vertices (i ∈ V ), some of which are joined by edges ((i, j) ∈ E). For example:

1

2

3

4







Thus a graph is a partially

drawn Markov chain dia-

gram. There is a natural

way to complete the dia-

gram which gives rise to

the random walk on G.

1

2

3

4



1



2

1



2

1



2

1



2

1



3

1



3

1



3

1



3

1



3

1



3

The valence (or degree) vi of vertex i is the number of edges at i.

We assume

that every vertex has ﬁnite valence. The random walk on G picks edges with equal

probability:

Thus the transition probabilities are given by

pij =

�

1/vi

if (i, j) ∈ E

0

otherwise

Assume G is connected, so that P is irreducible. It is easy to see that P is in detailed

balance with v = (vi : i ∈ G), i.e. viPij = vi(1/vi) = 1. So, if the total valence

σ = �

i vi is ﬁnite. then πi = vi/σ is invariant and P is reversible.

The invariant distribution in this example is π = (1/10)(2, 3, 2, 3). So, for example,

m1 = 1/π1 = 5.

43


Example 11.6. Random walk on a tree with arbitrary transition probabilities.

1

3

2

4

6

5

1.0

1.0

1.0

1.0

.75

.20

.20

.40

.20

.25

Clearly, we can solve detailed balance equations if there are no cycles. E.g.

π1 × 1.0 × 0.75 × 0.40 = π5 × 1.0 × 0.20 × 0.25

Example 11.7 (Random chess board knight). A random knight makes each permis-

sible move with equal probability. If it starts in a corner, how long on average will it

take to return?

2

3

3

4

4

4

6

6

6

8

8

8

8

6

4

4







This is an example of a random walk on a graph: the vertices are the squares of the

chess board and the edges are the moves that the knight can take. The diagram shows

valences of the 64 vertices of the graph. We know by Theorem 9.1 and the preceding

example that

Ec(Tc) = 1/πc =

�

i vi



vc

so all we have to do is, identify valences. The four corner squares have valence 2; and

the eight squares adjacent to the corners have valence 3. There are 20 squares of valence

4; 16 of valence 6; and the 16 central squares have valence 8. Hence,

Ec(Tc) = 8 + 24 + 80 + 96 + 128



2

= 168.

Obviously this is much easier than solving sets of 64 simultaneous linear equations to

ﬁnd π from πP = π, or calculating Ec(Tc) using Theorem 3.4.

44


12

Concluding problems and recommendations for

further study

12.1

Reversibility and Ehrenfest’s urn model

Example 12.1 (Ehrenfest’s urn model). In Ehrenfest’s model for gas diﬀusion N balls

are placed in 2 urns. Every second, a ball is chosen at random and moved to the other

urn (Paul Ehrenfest, 1880–1933). At each second we let the number of balls in the ﬁrst

urn, i, be the state. From state i we can pass only to state i − 1 and i + 1, and the

transition probabilities are given by

0

1



1/N

1 − 1/N

i/N

1/N

1

1

1 − i/N

i

i + 1

i − 1

N

This deﬁnes the transition matrix of an irreducible Markov chain. Since each ball moves

independently of the others and is ultimately equally likely to be in either urn, we can

see that the invariant distribution π is the binomial distribution with parameters N

and 1/2. It is easy to check that this is correct (from detailed balance equations). So,

πi = 1



2N

�N

i

�

,

and mi = 2N � �N

i

�

.

Consider in particular the central term i = N/2. We have seen that this term is

approximately 1/

�



πN/2. Thus we may approximate mN/2 by

�



πN/2.

Assume that we let our system run until it is in equilibrium. At this point, a video

is made, shown to you, and you are asked to say if it is shown in the forward or the

reverse direction. It would seem that there should always be a tendency to move toward

an equal proportion of balls so that the correct order of time should be the one with

the most transitions from i to i − 1 if i &gt; N/2 and i to i + 1 if i &lt; N/2. However, the

reversibility of the process means this is not the case.

The following chart shows {Xn}500

n=300 in a simulation of an urn with 20 balls, started

at X0 = 10. Next to it the data is shown reversed. There is no apparent diﬀerence.

0

50

100

150

200

5

10

15

20

0

50

100

150

200

5

10

15

20

45


12.2

Reversibility and the M/M/1 queue

Example 12.2. Consider the following random walk with 0 &lt; p = 1 − q &lt; 1/2.

0

1

i+1

i

i-1



p

p

p

p

p

q

q

q

q

q

This is a discrete time version of the M/M/1 queue. At each discrete time instant

there is either an arrival (with probability p) or a potential service completion (with

probability q). The potential service completion is an actual service completion if the

queue is nonempty.

Suppose we do not observe Xn, but we hear a beep at time n + 1 if Xn+1 = Xn + 1.

We hear a chirp if Xn+1 = Xn − 1. There is silence at time n + 1 if Xn = Xn+1 = 0.

What can we say about the pattern of sounds produced by beeps and chirps?

If we hear a beep at time n then the time of the next beep is n + Y where Y is

a geometric random variable with parameter p, such that P(Y = k) = qk−1p, k =

1, 2, . . . . Clearly EY = 1/p. As for chirps, if we hear a chirp at time n, then time of

the next chirp is at n + Z, with P(Z = k) = pk−1q, and EZ = 1/q, but only if Xn &gt; 0.

If Xn = 0 then the time until the next chirp is at n+ T where T has the distribution of

Y + Z. This suggests that we might be able to hear some diﬀerence in the soundtracks

of beeps and chirps.

However, (Xn)n≥0 is reversible, with pπi = qπi+1, i = 0, 1, . . .. So once we have

reached equilibrium the reversed process has the same statistics as forward process.

Steps of i → i + 1 and i + 1 → i are interchanged when we run the process in reverse.

This means that the sound pattern of the chirps must be the same as that of beeps, and

we must conclude that the distribution of the times between successive chirps are also

i.i.d. geometric random variable with parameter p. This is surprising! The following

simulations is for p = 0.45.



chirps

beeps

silent

Burke’s Theorem (1956) is a version of this result for the continuous time Markov

process known as the M/M/1 queue. This is a single-server queue to which customers

arrive as a Poisson process of rate λ, and in which service times are independent and

exponentially distributed with mean 1/µ (and µ &gt; λ). Burke’s theorem says that the

steady-state departure process is a Poisson process with rate parameter λ. This means

46


that an observor who sees only the departure process cannot tell whether or not there is

a queue located between the input and output! Equivalently, if each arrival produces a

beep and each departure produces a chirp, we cannot tell by just listening which sound

is being called a beep and which sound is being called a chirp.

12.3

*The probabilistic abacus*

Peter Winkler (Mathematical Mind-Benders, 2007) poses the following puzzle. “In a

circle are n children, each holding some gumdrops. The teacher gives an additional

gumdrop to each child who has an odd number, then each child passes half of his or her

gumdrops to the child on his left. These two steps are repeated until they no longer

have any eﬀect. Prove that this process will indeed eventually terminate, with all kids

have the same (even) number of gumdrops.”

To solve this puzzle, let mi(t) be the number of gumdrops held by the child i just

before they pass for the (t + 1)th time, t = 0, 1, . . . . Let M = maxi mi(0). Notice that

mi(1) ≤ M for all i, and inductively mi(t) ≤ M for all i and t. But until the game ends

the teacher gives out at least 1 gumdrop per round. Hence the game must terminate

within a ﬁnite number of rounds.

Grinstead and Snell describe a similar algorithm which works for more general

Markov chains as follows (pages 445–447). Let P = (pij) be the n×n transition matrix

of an irreducible and aperiodic Markov chain of n states, with all entries rational.

A class of n children plays a game of successive rounds. Initially, child i has mi(0)

gumdrops, and at end of a round t she has mi(t) gumdrops. The teacher then hands

out gumdrops so that each child has ni(t) gumdrops, where ni(t) is the least number

not less than mi(t) such that pijni(t) is an integer, for every j. Finally, for each i and

j, child i passes pijni(t) gumdrops to child j. That completes the round, child i now

has mi(t + 1) gumdrops, and the game continues to the round t + 1. Again, we can

see that in a ﬁnite number of rounds we are guaranteed to reach a situation in which

the teacher does not have to give out any more gumdrops, and that the holdings of

gumdrops correspond to an invariant measure.

(This is the algorithm for computing an invariant distribution that is described

by Arthur Engel, Wahrscheinlichkeitsrechnung und Statistik, vol. 2 (Stuttgart: Klett

Verlag, 1976).

He also describes an algorithm for an absorbing Markov chain that

calculates the absorption probabilities. See Appendix C.)

12.4

*Random walks and electrical networks*

Recall the problem of ﬁnding absorption probabilities. Consider random walk on a

graph and let hx = Px(Ha &lt; Hb), the probability when starting from x of hitting a

before b.

47




x

x

y

y

a

a

b

b

L

L

vb = 0

va = 1

This satisﬁes the right hand equations h = Ph, with boundary conditions, i.e.

hx =

�

y

pxyhy =

�

y

1



dx

hy, x ̸= a, b,

with ha = 1, hb = 0.

(12.1)

where dx is the degree (or valence) of node x.

Now consider the electrical network in which a 1 ohm resistor replaces each link

and a battery holds the voltages at a and b to 1 and 0 respectively. By Ohm’s Law the

current from x to y is

ixy =

voltage drop from x to y



resistance between x and y = vx − vy



1

.

By Kirchhoﬀ’s Laws, the current into x must be equal to the current out. So for x ̸= a, b

0 =

�

y

ixy =

�

y

(vx − vy) =⇒ vx =

�

y

1



dx

vy.

Thus v satisﬁes the same equations (12.1) as does h and so h = v. A function h which

satisﬁes h = Ph is said to be a harmonic function.

We can now consider the following questions: (i) what is the probability, starting

at a that we return to a before hitting b? (ii) how does this probability change if we

remove a link, such as L?

We have seen that to answer (i) we just put a battery between a and b, to ﬁx va = 1

and vb = 0, and unit resistors at each link. Then vy is the probability that a walker

who starts at y hits a before b. Also, �

y payvy is the probability that a walker who

starts at a returns to a before reaching b.

The current ﬂowing out of a (and in total around the whole network) is

�

y

iay =

�

y

(va − vy) = da

�

1 −

�

y

payvy

�

= da (1 − Pa(Ha &lt; Hb)) .

Rayleigh’s Monotonicity Law says that if we increase the resistance of any resistor

then the resistance between any two points can only increase. So if we remove a link,

such as L, (which is equivalent to increasing the resistance of the corresponding resistor

to inﬁnity), then the resistance between points a and b increases, and so that a voltage

48


diﬀerence of 1 drives less current around the network and thus the quantity �

y payvy

increases, i.e. Pa(Ha &lt; Hb) increases. It is perhaps a bit surprising that the removal

of a link always has this eﬀect, no matter where that link is located in the graph.

We may let the size of the network increase towards that of the inﬁnite lattice of

resistors and ask “What happens to the eﬀective resistance between the node at the

centre and those nodes around the outer boundary as the distance between them tends

to inﬁnity?”. By what we know of recurrence properties of symmetric andom walk, it

must be that in 1 and 2 dimensions the eﬀective resistance tends to inﬁnity, whereas

in 3 dimensions it tends to something ﬁnite.

(This next bit will probably not be lectured.) We can also give a nice interpretation

of the current in a link as the net ﬂow of electrons across the link as the electrons

are imagined to perform random walks that start at a and continue until reaching b.

Speciﬁcally, suppose a walker begins at a and performs a random walk until reaching b;

note that if he returns to a before reaching b, he keeps on going. Let ux = Ea[Vx(Tb)]

be the expected number of visits to state x before reaching b. Clearly, for x ̸= a, b,

ux =

�

y

uypyx,

which is equivalent to ux



dx

=

�

y

pxy

uy



dy

.

Thus ux/dx is harmonic, with ub = 0. So u = v for a network in which we ﬁx vb = 0.

The current from x to adjacent node y is

ixy = vx − vy = ux



dx

− uy



dy

= uxpxy − uypyx.

Now uxpxy is the expected value of the number of times that the walker will pass along

the edge from x to y. Similarly, uypyx is the expected value of the number of times that

the walker will pass along the edge from y to x. So the current ixy has an interpretation

as the expected value of the net number of times that the walker will pass along the

edge from x to y, when starting at a and continuing until hitting b. We should ﬁx va

so that �

y iay = 1 since, given a start at a, this is necessarily 1.

49


12.5

Probability courses in Part II

There are several courses in Part II of the tripos that should interest you if you have

enjoyed this course. All of these build on Probability IA, and the knowledge of Markov

Chains which you now have gained (although Markov Chains is not essential).

Probability and Measure: this course develops important concepts such as ‘expec-

tation’ and the ‘strong law of large numbers’ more rigorously and generally than

in Probability IA. Limits are a key theme.

For example, one can prove that

that certain ‘tail events’ can only have probabilities of 0 or 1. We have seen a

example of this in our course: Pi(Xn makes inﬁnitely many returns to i) takes

values 0 or 1 (never 1/2). The Measure Theory that is in this course is impor-

tant for many mathematicians, not just those who are specializing in optimiza-

tion/probability/statistics.

Applied Probability: this course is about Markov processes in continuous time, with

applications in queueing, communication networks, insurance ruin, and epidemics.

Imagine our frog in Example 1.1 waits for an exponentially distributed time before

hopping to a new lily pad. What now is p57(t), t ≥ 0? As you might guess, we

ﬁnd this by solving diﬀerential equations, in place of the recurrence relations we

had in discrete time.

Optimization and Control: we add to Markov chains notions of cost, reward, and

optimization. Suppose a controller can pick, as a function of the current state

x, the transition matrix P, to be one of a set of k possible matrices, say P(a),

a ∈ {ak, . . . , ak}. We have seen this type of problem in asking how should a

gambler bet when she wishes to maximize her chance of reaching 10 pounds, or

asking how many ﬂowers should a theatre owner send to a disguntled opera singer.

Perhaps we would like to steer the frog to arrive at some particular lily pad in

the least possible time, or with the least cost.

Suppose three frogs are placed at diﬀerent vertices of Z2. At each step we can

choose one of the frogs to make a random hop to one of its neighbouring vertices.

We wish to minimize the expected time until we ﬁrst have a frog at the origin.

One could think of this as a ‘playing golf with more than one ball’.

Stochastic Financial Models: this is about random walks, Brownian motion, and

other stochastic models that are useful in modelling ﬁnancial products.

We might like to design optimal bets on where the frog will end up, or hedge the

risk that he ends up in an unfavourable place.

For example, suppose that our frog starts in state i and does a biased random

walk on {0, 1, . . ., 10}, eventually hitting state 0 or 10, where she then wins a

prize worth £0 or £10. How much would we be willing to pay at time 0 for the

right (option) to buy her ﬁnal prize for £s?

I hope some of you will have enjoyed Markov Chains to such an extent that you will

want to do all these courses in Part II!

50


Appendix

A

Probability spaces

The models in this course take place in a probability space (Ω, F, P). Let us brieﬂy

review what this means.

• Ω is a set of outcomes (ω ∈ Ω)

• F is a nonempty set of subsets of Ω (corresponding to possible events), and such

that

(i) Ω ∈ F

(ii) A ∈ F =⇒ Ac ∈ F

(iii) An ∈ F for n ∈ N =⇒ �

n∈N An ∈ F (a union of countably many members

of F)

Note that these imply �

n∈N An ∈ F, because �

n An = (�

n Ac

n)c.

A collection of subsets with these properties is called a σ-algebra or σ-ﬁeld.

(‘sigma’ refers to the fact we are dealing with countable unions.)

• P : F → [0, 1] satisﬁes

– P(Ω) = 1

– An ∈ F for n ∈ N, An disjoint =⇒ P(�

n An) = �∞

n=1 P(An).

Note that this sum is well-deﬁned, independently of how we enumerate the An. For if

(Bn : n ∈ N) is an enumeration of the same sets, but in a diﬀerent order, then given

any n there exists an m such that

n�

i=1

Ai ⊆

m

�

i=1

Bi

and it follows that �∞

i=1 P(Ai) ≤ �∞

i=1 P(Bi). Clearly, ≥ is also true, so the sums are

equal. Another important consequence of these axioms is that we can take limits.

Proposition A.1. If (An)n∈N is a sequence of events and limn→∞ An = A, then

limn→∞ P(An) = P(A).

We use this repeatedly. For example, if Vi is the number of visits to i, then

Pi(Vi = ∞) = Pi(limk→∞[Vi ≥ k]) = limk→∞ Pi(Vi ≥ k) = limk→∞ f k

i , which is 0 or 1,

since 0 ≤ fi ≤ 1 (we cannot have Pi(Vi = ∞) = 1/2).

• X : Ω → I is a random variable if

{X = i} = {ω ∈ Ω : X(ω) = i} ∈ F for all i ∈ I.

Then P(X = i) = P({X = i}). This is why we require {X = i} ∈ F.

51


B

Historical notes

Grinstead and Snell (Introduction to Probability, 1997) say the following (pages 464–

465):

“Markov chains were introduced by Andrei Andreyevich Markov (1856–1922) and

were named in his honor. He was a talented undergraduate who received a gold medal

for his undergraduate thesis at St. Petersburg University. Besides being an active re-

search mathematician and teacher, he was also active in politics and participated in the

liberal movement in Russia at the beginning of the twentieth century. In 1913, when the

government celebrated the 300th anniversary of the House of Romanov family, Markov

organized a counter-celebration of the 200th anniversary of Bernoulli’s discovery of the

Law of Large Numbers.

Markov was led to develop Markov chains as a natural extension of sequences of

independent random variables. In his ﬁrst paper, in 1906, he proved that for a Markov

chain with positive transition probabilities and numerical states the average of the

outcomes converges to the expected value of the limiting distribution (the ﬁxed vector).

In a later paper he proved the central limit theorem for such chains. Writing about

Markov, A. P. Youschkevitch remarks:

Markov arrived at his chains starting from the internal needs of probability

theory, and he never wrote about their applications to physical science. For

him the only real examples of the chains were literary texts, where the two

states denoted the vowels and consonants.1 ed. C. C. Gillespie (New York:

Scribner’s Sons, 1970), pp. 124–130.)

In a paper written in 1913,2 Markov chose a sequence of 20,000 letters from

Pushkin’s Eugene Onegin to see if this sequence can be approximately considered a

simple chain. He obtained the Markov chain with transition matrix

�.128

.872

.663

.337

�

The ﬁxed vector for this chain is (.432, .568), indicating that we should expect about

43.2 percent vowels and 56.8 percent consonants in the novel, which was borne out by

the actual count.”



1See ‘Dictionary of Scientiﬁc Biography,

2A. A. Markov, “An Example of Statistical Analysis of the Text of Eugene Onegin Illustrating the

Association of Trials into a Chain,” Bulletin de l’Acadamie Imperiale des Sciences de St. Petersburg,

ser. 6, vol. 7 (1913), pp. 153–162.

52


C

The probabilistic abacus for absorbing chains

This section is about Engel’s ‘probabilistic abacus’, an algorithmic method of computing

the absorption probabilities of an absorbing Markov chain. The version of the abacus

that calculates the invariant distribution of a recurrent Markov chain has already been

described in §12.3.

These algorithms are of no practical value!

However, they are

interesting because it is challenging to understand why they work, and thinking about

that will help to build your intuition for Markov processes.

Consider an absorbing Markov chain with rational transition probabilities, as in

P =















1



2

1



4

1



4

0

0

1



3

0

1



3

1



3

0

0

0

1



3

0

2



3

0

0

0

1

0

0

0

0

0

1















1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

Clearly {1, 2, 3} are transient and {4, 5} are absorbing.

Suppose we want to ﬁnd α14, the probability that starting in state 1 absorption

takes place in state 4. We can do this by Engel’s algorithm, which is equivalent to

playing a so-called chip ﬁring game. It works like this. We create one node for each

state and put some chips (or tokens) at the nodes corresponding to the non-absorbing

states, {1, 2, 3}. Suppose that there are integers ri, ri1, . . . , rin such that pij = rij/ri

for all j. If there were ri chips at node i we could ‘ﬁre’ or ‘make a move’ in node i.

This means taking ri chips from node i and moving rij of them to node j, for each j.

The critical loading is one in which each node has one less chip that it needs to ﬁre,

i.e. ci = ri − 1. So c1 = 3 and c2 = c3 = 2. We start with a critical loading by placing

tokens at nodes 1, 2, 3, 4, 5 in numbers:

(3, 2, 2, 0, 0),

as shown above, and then add a large number of tokens to another node 0. ‘Firing’

node 0 means moving one token from node 0 to node 1. Engel’s algorithm also imposes

the rule that node 0 may be ﬁred only if no other node can ﬁre. Starting from the

critical loading we ﬁre node 0 and then node 1:

(3, 2, 2, 0, 0)

0→ (4, 2, 2, 0, 0)

1→ (2, 3, 3, 0, 0)

53


1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

Now nodes 2 or 3 could ﬁre. Suppose we ﬁre 3 and then 23:

(2, 3, 3, 0, 0)

3→ (2, 3, 1, 0, 2)

2→ (3, 0, 2, 1, 2)

1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

Now we ﬁre the sequence 0, 1, 3, 0, 0, 1, 0:

(3, 0, 2, 1, 2)

0→ (4, 0, 2, 1, 2)

1→ (2, 1, 3, 1, 2)

3→ (2, 1, 1, 1, 4)

0→ (3, 1, 1, 1, 4)

0→ (4, 1, 1, 1, 4)

1→ (2, 2, 2, 1, 4)

0→ (3, 2, 2, 1, 4)

1/2

1/4

1/4

1/3

1/3

1/3

1/3

2/3

At this point we stop, because nodes 1, 2 and 3 now have exactly the same loading

as at the start. We are at (3, 2, 2, 0, 0) + (0, 0, 0, 1, 4). We have ﬁred 0 ﬁve times and

ended up back at the critical loading, but with 1 token in node 4 and 4 tokens in node

5. Thus α14 = 1/5 and α15 = 4/5.

Why does this algorithm work? It is fairly obvious that if the initially critically

loaded conﬁguration of the transient states reoccurs then the numbers of tokens that

have appeared in the nodes that correspond to the absorbing states must be in quantities

that are in proportion to the absorptions probabilities, α1j.

But why is the initial



3If we ﬁre 2 then we reach (3, 0, 4, 1, 0) and we next must ﬁre 0 again, but ultimately the ﬁnal

conﬁguration will turn out to be the same.

54


critically loaded conﬁguration guaranteed to eventually reappear? This puzzled Engel

in 1976, and was proved circa 1979 by Peter Doyle, whose proof we now present. It is

much more diﬃcult than to prove that the abacus described in §12.3 terminates. (The

proof is interesting. There is, in fact, a rich literature on the properties of chip ﬁring

games and this proof generalises to show that many chip ﬁring games have the property

that the termination state does not depend on the order in which moves are made.)

Proof that the critical loading reoccurs.

1. At times that we ﬁre node 0 the loadings of the nodes corresponding to the non-

absorbing states are no greater than their critical loadings. There are only ﬁnitely

many such possible loadings. So some loading must reoccur. Call this loading L.

2. Start by loading L in white tokens. By hypothesis, if we continue from this initially

loading then we will eventually return to it after some sequence of ﬁrings, say f =

(f0, fi2, . . . , fiN ), of which m of them are ﬁrings of node 0. Let us add red tokens to

each node so as to take the loading up to the critical loading. Put just m white tokens

at node 0. We now compare the result of two diﬀerent strategies of play.

Strategy I is to follow Engel’s algorithm until we run out of tokens in node 0.

Strategy II is to make the ﬁring sequence f, using only white tokens. Here we no

longer impose the rule that node 0 can ﬁre only if no other node can. When we run

out of token in node 0, L reoccurs and so we are back at the critical loading.

The proof is ﬁnished by proving that from any initial loading, the loading obtained at

the end, when the m tokens in node 0 have run out, is independent of any choices that

we make along the way about which of several available nodes we might ﬁre. Assuming

this is true, then by starting in the critical loading and following Engel’s algorithm until

tokens in node 0 run out, we end in the same place as Strategy II, which we know ends

in the critical loading. So the critical loading reoccurs under Engel’s algorithm also.

3. Finally, we prove our claim. Suppose that up to the point that no more ﬁrings

become possible Strategy I ﬁres sequentially the nodes e1, . . . , eN, and Strategy II ﬁres

sequentially the nodes f1, . . . , fM. We now show that these are the same set of ﬁrings

arranged in diﬀerent orders, and hence N = M and terminal loadings are identical.

Consider ﬁring e1. If none of f1, . . . , fM are node e1 then this sequence f cannot

have terminated, because there must be enough tokens in node e1 to ﬁre it. So some

fi1 = e1. Suppose we have proved that e1, . . . , ek are in 1–1 correspondence with some

fi1, . . . , fik. Consider ek+1. If there is a fk+1 amongst the fi which occurs in addition

to fi1, . . . , fik, and before these are all carried out, then we can choose to match this to

ek+1. Suppose there was no such fi. The ﬁring ek+1 was made possible by e1, . . . , ek.

It must also have been made possible by fi1, . . . , fik. Any other ﬁrings that have been

made can only help by adding tokens to node ek+1. So there must be at least one more

ﬁring subsequent to all of fi1, . . . , fik that is of node ek+1. So again, we can make a

match. Inductively, the ei’s are contained within the fi’s. By that same argument the

reverse is true and we conclude that the two sets of ﬁrings are the same.









55


Index

absorbing, 8

absorption probability, 9

almost surely, 26

aperiodic, 34

birth-death chain, 13

Burke’s theorem, 46

Chapman-Kolomogorov equations, 3

chip ﬁring game, 53

class property, 18

closed class, 8, 19

communicating classes, 8

convergence to equilibrium, see ergodic

theorem

coupling, 35

degree, 43

detailed balance, 27, 42

distribution, 2

Doblin, V., 35

Ehrenfest’s urn model, 45

electrical networks, 47

Engel’s probabilistic abacus, 47, 53

equilibrium distribution, 25, 28

equivalence relation, 8

ergodic chain, 34

ergodic theorem, 37

evening out the gumdrops, 47

expected return time, see mean return

time

ﬁrst passage time, 17, 25, 37

gambler’s ruin, 12, 16

harmonic function, 48

hitting time, 9, 17

initial distribution, 2

invariant distribution, 25–33

existence and uniqueness, 29

invariant measure, 25

irreducible, 8

Kemeny’s constant, see random target

lemma

left hand equations, 26

magic trick, 35

Markov chain, 2

simulation of, 3

Markov property, 6

Markov, A. A., 1, 52

mean hitting time, 9

mean recurrence times, 39

mean return time, 17, 25, 31

measure, 2

M/M/1 queue, 46

n-step transition matrix, 3

null recurrent, 31

number of visits, 17

open class, 8

periodic, 34

P´olya, G., 23

positive recurrent, 31

probabilistic abacus, 47, 53

probability space, 2, 51

random surfer, 32

random target lemma, 39

random variable, 51

random walk, 10, 33

and electrical networks, 47–49

of a knight on a chessboard, 44

on a complete graph, 6

on a graph, 43

on a triangle, 42

on {0, 1, . . ., N}, 10

on {0, 1, . . .}, 12

56


on Zd, 21–24

Rayleigh’s Monotonicity Law, 48

recurrent, 17

regular chain, 34

return probability, 17

reversibility, 42–47

reversible, 43

right hand equations, 11

rth excursion, 38

rth passage time, 38

σ-algebra, 51

σ-ﬁeld, 51

state, 2

state-space, 2

stationary distribution, 25, 28

steady state distribution, 25

stochastic matrix, 2

stopping time, 15

strong law of large numbers, 37

strong Markov property, 15

success-run chain, 27

transient, 17

transition matrix, 2

two-state Markov chain, 4

valence, 43, 48

57

